
This directory contains a set of tests for the EnsEMBL Compara API
modules. The test-genome-DBs.zip file contains the set of data that is 
used by the tests.

In order to run the tests you must update the MultiTestDB.conf
file with the information (username, host, etc.) for a mysql
instance where you have write permission. Running test case(s)
which require a database will automatically create and remove 
a temporary database during the test(s) execution.

Running all tests or just a single test
=======================================

To run multiple tests at once use the runtests.pl script in
the modules directory. To run a single test simply execute
the .t file:

Examples:

#run all tests in the t directory
perl runtests.pl t

#run 3 tests
perl runtests.pl t/dnaFrag.t t/genomeDBAdaptor.t t/genomicAlignAdaptor.t

#run a single test
perl t/dnaFrag.t

Creating the small test databases in test-genome-DBs.zip
========================================================

Description of the procedure to create a small compara dabatase as well as small core
databases for human, mouse and rat.
You will need to have complete compara, human core, mouse core and rat core on the
MySQL instance you plan to create your test database, here
 ensembl_compara_23_1
 homo_sapiens_core_23_34e
 mus_musculus_core_23_32c
 rattus_norvegicus_core_23_3c
respectively

cd ~/src/ensembl_main/ensembl-compara/modules/t

./CreateComparaTestDatabase.pl -s ensembl_compara_23_1 -d ensembl_compara_test -h ia64f -u ensadmin -p ensembl --port 3306 --seq_region_file homo_sapiens.seq_region_file

./CreateCoreTestDatabase.pl -s homo_sapiens_core_23_34e -d homo_sapiens_core_test -h ia64f -u ensadmin -p ensembl --port 3306 --seq_region_file homo_sapiens.seq_region_file 

This above script ill have created the mus_musculus.seq_region_file and rattus_norvegicus.seq_region_file files for the folowing steps.

./CreateCoreTestDatabase.pl -s mus_musculus_core_23_32c -d mus_musculus_core_test -h ia64f -u ensadmin -p ensembl --port 3306 --seq_region_file mus_musculus.seq_region_file

./CreateCoreTestDatabase.pl -s rattus_norvegicus_core_23_3c -d rattus_norvegicus_core_test -h ia64f -u ensadmin -p ensembl --port 3306 --seq_region_file rattus_norvegicus.seq_region_file

 Dumping the databases. For use of mysqldump with -T option, you will need to run it on 
 the same machine that runs the MySQL instance, here ia64f

mkdir -p test-genome-DBs/homo_sapiens/core test-genome-DBs/mus_musculus/core test-genome-DBs/rattus_norvegicus/core test-genome-DBs/multi/compara

cd test-genome-DBs/homo_sapiens/core

/usr/local/ensembl/mysql/bin/mysqldump -hia64f -uensadmin -pensembl -P3306 --socket=/mysql/data_3306/mysql.sock -T ./ homo_sapiens_core_test

cd ../../mus_musculus/core

/usr/local/ensembl/mysql/bin/mysqldump -hia64f -uensadmin -pensembl -P3306 --socket=/mysql/data_3306/mysql.sock -T ./ mus_musculus_core_test

cd ../../rattus_norvegicus/core

/usr/local/ensembl/mysql/bin/mysqldump -hia64f -uensadmin -pensembl -P3306 --socket=/mysql/data_3306/mysql.sock -T ./ rattus_norvegicus_core_test

cd test-genome-DBs/multi/compara

/usr/local/ensembl/mysql/bin/mysqldump -hia64f -uensadmin -pensembl -P3306 --socket=/mysql/data_3306/mysql.sock -T ./ ensembl_compara_test

cd ../../

zip -r -b /tmp test-genome-DBs test-genome-DBs
