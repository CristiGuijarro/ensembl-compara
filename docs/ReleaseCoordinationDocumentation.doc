Message-ID: <616993977.17310.1411131409511.JavaMail.crs_adm@ves-ebi-f3.ebi.ac.uk>
Subject: Exported From Confluence
MIME-Version: 1.0
Content-Type: multipart/related; 
	boundary="----=_Part_17309_203323822.1411131409511"

------=_Part_17309_203323822.1411131409511
Content-Type: text/html; charset=UTF-8
Content-Transfer-Encoding: quoted-printable
Content-Location: file:///C:/exported.html

<html xmlns:o=3D'urn:schemas-microsoft-com:office:office'
      xmlns:w=3D'urn:schemas-microsoft-com:office:word'
      xmlns:v=3D'urn:schemas-microsoft-com:vml'
      xmlns=3D'urn:w3-org-ns:HTML'>
<head>
    <meta http-equiv=3D"Content-Type" content=3D"text/html; charset=3Dutf-8=
">
    <title>Release coordination documentation</title>
    <!--[if gte mso 9]>
    <xml>
        <o:OfficeDocumentSettings>
            <o:TargetScreenSize>1024x640</o:TargetScreenSize>
            <o:PixelsPerInch>72</o:PixelsPerInch>
            <o:AllowPNG/>
        </o:OfficeDocumentSettings>
        <w:WordDocument>
            <w:View>Print</w:View>
            <w:Zoom>90</w:Zoom>
            <w:DoNotOptimizeForBrowser/>
        </w:WordDocument>
    </xml>
    <![endif]-->
    <style>
                <!--
        @page Section1 {
            size: 8.5in 11.0in;
            margin: 1.0in;
            mso-header-margin: .5in;
            mso-footer-margin: .5in;
            mso-paper-source: 0;
        }

        td {
            page-break-inside: avoid;
        }

        tr {
            page-break-after: avoid;
        }

        div.Section1 {
            page: Section1;
        }

        /* Confluence print stylesheet. Common to all themes for print medi=
a */
/* Full of !important until we improve batching for print CSS */

#main {
    padding-bottom: 1em !important; /* The default padding of 6em is too mu=
ch for printouts */
}

body {
    font-family: Arial, Helvetica, FreeSans, sans-serif;
    font-size: 10pt;
    line-height: 1.2;
}

body, #full-height-container, #main, #page, #content, .has-personal-sidebar=
 #content {
    background: #fff    !important;
    color: #000         !important;
    border: 0           !important;
    width: 100%         !important;
    height: auto        !important;
    min-height: auto    !important;
    margin: 0           !important;
    padding: 0          !important;
    display: block      !important;
}

a, a:link, a:visited, a:focus, a:hover, a:active {
    color: #000;
}
#content h1,
#content h2,
#content h3,
#content h4,
#content h5,
#content h6 {
    font-family: Arial, Helvetica, FreeSans, sans-serif;
    page-break-after: avoid;
}
pre {
    font-family: Monaco, "Courier New", monospace;
}

#header,
.aui-header-inner,
#navigation,
#sidebar,
.sidebar,
#personal-info-sidebar,
.ia-fixed-sidebar,
.page-actions,
.navmenu,
.ajs-menu-bar,
.noprint,
.inline-control-link,
.inline-control-link a,
a.show-labels-editor,
.global-comment-actions,
.comment-actions,
.quick-comment-container,
#addcomment {
    display: none !important;
}

.comment .date::before {
    content: none !important; /* remove middot for print view */
}

h1.pagetitle img {
    height: auto;
    width: auto;
}

.print-only {
    display: block;
}
#footer {
    position: relative !important; /* CONF-17506 Place the footer at end of=
 the content */
    margin: 0;
    padding: 0;
    background: none;
    clear: both;
}

#poweredby {
    border-top: none;
    background: none;
}

#poweredby li.print-only {
    display: list-item;
    font-style: italic;
}

#poweredby li.noprint {
    display:none;
}


/* no width controls in print */
.wiki-content .table-wrap,
.wiki-content p,
.panel .codeContent,
.panel .codeContent pre,
.image-wrap {
    overflow: visible !important;
}

/* TODO - should this work? */
#children-section,
#comments-section .comment,
#comments-section .comment .comment-body,
#comments-section .comment .comment-content,
#comments-section .comment p {
    page-break-inside: avoid;
}

#page-children a {
    text-decoration: none;
}

/**
 hide twixies

 the specificity here is a hack because print styles
 are getting loaded before the base styles. */
#comments-section.pageSection .section-header,
#comments-section.pageSection .section-title,
#children-section.pageSection .section-header,
#children-section.pageSection .section-title,
.children-show-hide {
    padding-left: 0;
    margin-left: 0;
}

.children-show-hide.icon {
    display: none;
}

/* personal sidebar */
.has-personal-sidebar #content {
    margin-right: 0px;
}

.has-personal-sidebar #content .pageSection {
    margin-right: 0px;
}
-->
    </style>
</head>
<body>
    <h1>Release coordination documentation</h1>
    <div class=3D"Section1">
        <h3 id=3D"Releasecoordinationdocumentation-/*&lt;![CDATA[*/div.rbto=
c1411131408848{padding:0px;}div.rbtoc1411131408848ul{list-style:disc;margin=
-left:0px;}div.rbtoc1411131408848li{margin-left:0px;padding-left:0px;}/*]]&=
gt;*/DeclarationofIntentions#Releasecoordinationdocume"><style type=3D"text=
/css">/*<![CDATA[*/
div.rbtoc1411131408848 {padding: 0px;}
div.rbtoc1411131408848 ul {list-style: disc;margin-left: 0px;}
div.rbtoc1411131408848 li {margin-left: 0px;padding-left: 0px;}

/*]]>*/</style>
<div class=3D"toc-macro rbtoc1411131408848">=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-DeclarationofIntentions">D=
eclaration of Intentions</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Environmentvariables">Envi=
ronment variables</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Updateyourcheckouts">Updat=
e your&nbsp;checkouts</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-NCBItaxonomydata">NCBI tax=
onomy data</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Comparaservers">Compara se=
rvers</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Configurationfile">Configu=
ration file</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Updateschemaversion">Updat=
e schema version</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Updatetable.sqlandcreatepa=
tchfiles">Update table.sql and create patch files</a>=20
<ul class=3D"toc-indentation">=20
<li><a href=3D"#Releasecoordinationdocumentation-Checkthepatchfiles">Check =
the patch files &nbsp;</a></li>=20
</ul> </li>=20
<li><a href=3D"#Releasecoordinationdocumentation-RunCheckTaxonhealthcheck">=
Run CheckTaxon healthcheck</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Addnewgenome_dbtocomparama=
sterdatabase">Add new genome_db to compara master database</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Addmethod_link_species_set=
entriestocomparamasterdatabase">Add method_link_species_set entries to comp=
ara master database</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Addnewspeciestophylogeneti=
ctree">Add new species to phylogenetic tree</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finalcheckstocomparamaster=
database">Final checks to compara master database</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-CreateReleaseDatabase">Cre=
ate Release Database</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-MergeDNAdata">Merge DNA da=
ta</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-MergeGeneTrees+Families+NC=
Trees+PatchProjectionsAsHomologies">Merge GeneTrees+Families+NCTrees+PatchP=
rojectionsAsHomologies</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finaldatabasechecks">Final=
 database checks</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Runthehealthchecks">Run th=
e healthchecks</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Testwebserver">Test web se=
rver</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-RunANALYZE_TABLEandOPTIMIZ=
ETABLE">Run ANALYZE_TABLE and OPTIMIZE TABLE</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Copydatabasestostagingserv=
ers">Copy databases to staging servers</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finalhandoverofdatabases">=
Final handover of databases</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Updatedocumentationanddiag=
rams">Update documentation and diagrams</a></li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Datadumps">Data dumps</a><=
/li>=20
<li><a href=3D"#Releasecoordinationdocumentation-Finalthings">Final things<=
/a></li>=20
</ul>=20
</div></h3>
<h3 id=3D"Releasecoordinationdocumentation-DeclarationofIntentions"><span s=
tyle=3D"font-size: 14.0pt;">Declaration of Intentions</span></h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"4">Set up a web page<br /><p>O=
nce the release coordinator has sent out the email for the declaration of i=
ntentions, set up a web page with intentions in the Confluence wiki system =
to allow easy tracking of the progress.<br /> <a href=3D"/seqdb/confluence/=
display/EnsCom/Release+plans">Release plans</a></p></li>=20
<li class=3D"checked" data-inline-task-id=3D"5">Ask compara team members of=
 their intentions<br />Compara has one extra day to declare their intention=
s because of the need to know what the genebuilders and associated teams (e=
g wormbase, ensembl genomes) will declare</li>=20
<li class=3D"checked" data-inline-task-id=3D"6">Submit the declaration of i=
ntentions on the <a href=3D"http://admin.ensembl.org/index.html" class=3D"e=
xternal-link" rel=3D"nofollow">http://admin.ensembl.org/index.html</a> webs=
ite.</li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Environmentvariables">Environmen=
t variables</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"9"><span>Define $ENSEMBL_CVS_R=
OOT_DIR</span> <br /> <span>This is necessary to run the Hive and is used b=
y many scripts/files in this document. Make sure this is defined in your te=
rminal</span></li>=20
<li class=3D"checked" data-inline-task-id=3D"10"><span>Define $ENSADMIN_PSW=
</span> <br /> <span>The password for the mysql 'ensadmin' user also needed=
 for many scripts</span></li>=20
<li data-inline-task-id=3D"339"><span>Define $COMPARA_REG variable to simpl=
ify connecting to databases via registry</span> <br />export COMPARA_REG=3D=
&quot;-reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/prod=
uction_reg_conf.pl -reg_type compara -reg_alias&quot;</li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Updateyourcheckouts"><span>Updat=
e your&nbsp;checkouts</span></h3>
<p><span>Ensure you have up-to-date git checkouts of at least the following=
 repositories, pointing at master branch:<br /> </span></p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"35"><span>ensembl-compara</span></li>=20
<li data-inline-task-id=3D"36"><span>ensembl</span></li>=20
<li data-inline-task-id=3D"37"><span>ensembl-hive</span></li>=20
<li data-inline-task-id=3D"38"><span>ensembl-analysis</span></li>=20
<li data-inline-task-id=3D"39"><span>ensj-healthcheck<br /> </span></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-NCBItaxonomydata">NCBI taxonomy =
data</h3>
<p>The production team updates the ncbi_taxonomy database on livemirror jus=
t before the handover to us (please check that this has been done).</p>
<p>We then need to update the tables on our master DB. The current (rel.75)=
 master database is sf5_ensembl_compara_master on compara1</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"422"><p>Update the ncbi_taxa_node and ncbi_taxa_=
name in the master database</p>=20
<div id=3D"expander-137962002" class=3D"expand-container">=20
<div id=3D"expander-control-137962002" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-137962002" class=3D"expand-content">
<p>The ncbi_taxonomy database is located in <a rel=3D"nofollow">mysql://ens=
-livemirror:3306/ncbi_taxonomy</a></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>mysqldump</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time eval mysqldump --extended-insert --compress --delayed-inse=
rt `db_cmd.pl $COMPARA_REG ncbi_taxonomy -to_params` ncbi_taxa_node ncbi_ta=
xa_name | db_cmd.pl $COMPARA_REG=09compara_master</pre>=20
</div>
</div>=20
<div id=3D"expander-106699217" class=3D"expand-container">=20
<div id=3D"expander-control-106699217" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Times</span>=20
</div>=20
<div id=3D"expander-content-106699217" class=3D"expand-content">
<p>rel.64: 45 sec</p>
<p>rel.65: 47 sec</p>
<p>rel.66: 47 sec</p>
<p>rel.67: 30 sec</p>
<p>rel.68: 30 sec</p>
<p>rel.69: 35 sec</p>
<p>rel.70&nbsp; 32 sec</p>
<p>rel.71&nbsp; 34 sec</p>
<p>rel.72 36 sec</p>
<p>rel.74 36 sec</p>
<p>rel.75 38 sec</p>
<p>rel.76 44 sec</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li data-inline-task-id=3D"346">Check new extant taxon names<br /><p>Each n=
ew species must have a 'ensembl alias name' tag in the&nbsp;$ENSEMBL_CVS_RO=
OT_DIR/ensembl-compara/scripts/taxonomy/ensembl_aliases.sql file. It should=
 match the &quot;web_name&quot; used by the production team in the &quot;sp=
ecies&quot; table of their &quot;ensembl_production&quot; database on stagi=
ng1. This may have already been added by Ensembl Production.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>check species/taxa from ensembl_production</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG ensembl_production -sql 'select producti=
on_name, web_name, taxon from species'</pre>=20
</div>
</div>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"352"><p>Update the ancestral taxon names</p><p>E=
ach new extant species is anchored to the species tree at a certain taxon. =
This taxon must be described with two fields in the ncbi_taxa_name table:<b=
r />&nbsp;- 'ensembl alias name': a &quot;simple English&quot; description =
of the taxon.</p><p>The script in scripts/taxonomy/place_species.pl helps i=
n placing the new species in the current compara species tree and discover =
the new extant species:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>check species/taxa from ensembl_production</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/taxonomy/place_sp=
ecies.pl -master_url mysql://ensro@compara1/sf5_ensembl_compara_master -tax=
on_ids 9940,9361,7994,7918</pre>=20
</div>
</div><p><br />&nbsp;- 'ensembl timetree mya': the age of the taxon. It can=
 be obtained from the TimeTree database (<a href=3D"http://www.timetree.org=
" class=3D"external-link" rel=3D"nofollow">http://www.timetree.org</a>)</p>=
<p>For any new species, update the file $ENSEMBL_CVS_ROOT_DIR/ensembl-compa=
ra/scripts/taxonomy/ensembl_aliases.sql to add the two new tags</p></li>=20
</ul> </li>=20
<li data-inline-task-id=3D"28"><p>Load ensembl_aliases.sql onto the master =
database</p>=20
<div id=3D"expander-1153556563" class=3D"expand-container">=20
<div id=3D"expander-control-1153556563" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1153556563" class=3D"expand-content">
The script will report any discrepancies that need to be resolved ie any no=
des which have been deleted from the ncbi_taxonomy database but still have =
entries in the ensembl_aliases.sql file. Check if these have an entry in th=
e species_set_tag table. If not, it is probably safe to delete them. Check =
with other compara team members.
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>load ensembl_aliases</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG=09compara_master &lt; $ENSEMBL_CVS_ROOT_=
DIR/ensembl-compara/scripts/taxonomy/ensembl_aliases.sql</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Comparaservers">Compara servers<=
/h3>
<p>Check out the current space on the compara servers and delete the last b=
ut one release. <span>Leave the previous release for healthchecks.</span> <=
span>&nbsp;</span>Check with the other compara team members before deleting=
.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"18">Check space on <a href=3D"http://www.ebi.ac.=
uk/~mp/compara_servers_disk_load.html" class=3D"external-link" rel=3D"nofol=
low">http://www.ebi.ac.uk/~mp/compara_servers_disk_load.html</a> <br /> <sp=
an>&nbsp;</span></li>=20
<li data-inline-task-id=3D"80"><p><span>Ask compara team members to tidy up=
 any unwanted databases (run the command below for all compara servers) and=
 inform them of the intention to delete the last but one release<br /> </sp=
an></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>how much space do databases take?</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl/misc-scripts/db/db-space.pl =
-host compara4 -port 3306 -user ensadmin -password $ENSADMIN_PSW&nbsp;</pre=
>=20
</div>
</div></li>=20
<li data-inline-task-id=3D"19"><span>Delete ???_ensembl_compara_xx</span></=
li>=20
<li data-inline-task-id=3D"20"><span>Delete ???_ensembl_compara_ancestral_x=
x</span></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Configurationfile"><span>Configu=
ration file<br /> </span></h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"48"><p><span>&nbsp;Update production_reg_conf.pl=
</span> and check back into git:</p>=20
<div id=3D"expander-38865342" class=3D"expand-container">=20
<div id=3D"expander-control-38865342" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click for details</span>=20
</div>=20
<div id=3D"expander-content-38865342" class=3D"expand-content">
<p>Update the registry configuration file $ENSEMBL_CVS_ROOT_DIR/ensembl-com=
para/scripts/pipeline/production_reg_conf.pl that will be used throughout t=
he release process.</p>
<p>Make sure to have edited the release numbers, added external core databa=
ses and fixed name prefixes.</p>
<p>The convention right now (since rel.66) is to have the release database =
in compara3.</p>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Updateschemaversion"><span>Updat=
e schema version<br /> </span></h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"49">Update the schema_version in the master data=
base</li>=20
</ul>=20
<pre>update meta set meta_value =3D XX where meta_key =3D 'schema_version';=
</pre>
<h3 id=3D"Releasecoordinationdocumentation-Updatetable.sqlandcreatepatchfil=
es">Update table.sql and create patch files</h3>
<p>Update the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/table.sql file and crea=
te any patch files.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"51"><span> <span>Create a patch file for the sch=
ema_version</span> </span></li>=20
<li data-inline-task-id=3D"52"><span> <span> <span>Check if any other patch=
 files need creating by looking at the Declaration of Intentions and checki=
ng with other compara team members</span> </span> </span></li>=20
<li data-inline-task-id=3D"66"><span> <span> <span> <span> <span> <span>Upd=
ate the schema_version in table.sql</span> </span> </span> </span> </span> =
</span></li>=20
<li data-inline-task-id=3D"67"><span> <span> <span> <span>Delete the previo=
us patch INSERT statements from table.sql</span> </span> </span> </span> <s=
pan> <span> <span> <br /> </span> </span> </span></li>=20
<li data-inline-task-id=3D"53"><span>Add an INSERT statement for the new sc=
hema_version in table.sql and for any other new patches</span></li>=20
</ul>=20
<h4 id=3D"Releasecoordinationdocumentation-Checkthepatchfiles"><span>Check =
the patch files</span> <span style=3D"color: rgb(116,116,116);font-size: 10=
.0pt;line-height: 13.0pt;font-weight: normal;">&nbsp;</span></h4>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"356"><p>Create a new database from the current s=
chema</p>=20
<div id=3D"expander-1743718155" class=3D"expand-container">=20
<div id=3D"expander-control-1743718155" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1743718155" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>create new database</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl -url &quot;mysql://ensadmin:${ENSADMIN_PSW}@compara3/=
&quot; -sql 'CREATE DATABASE mp12_current_schema_test'
db_cmd.pl -url &quot;mysql://ensadmin:${ENSADMIN_PSW}@compara3/mp12_current=
_schema_test&quot; &lt; $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/sql/table.sql
mysqldump -u ensro -h compara3 -P3306 --no-data --skip-add-drop-table mp12_=
current_schema_test | sed 's/AUTO_INCREMENT=3D[0-9]*\b//' &gt;new_schema.sq=
l
</pre>=20
</div>
</div>
</div>=20
</div> <p><span style=3D"font-size: 10.0pt;line-height: 13.0pt;">&nbsp;</sp=
an></p></li>=20
<li data-inline-task-id=3D"360"><pre>        <span>Generate an empty databa=
se from the old schema, populate the meta table, apply the patches, dump it=
, and check that you get the new schema.</span>
      </pre>=20
<div id=3D"expander-1082934498" class=3D"expand-container">=20
<div id=3D"expander-control-1082934498" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click for details</span>=20
</div>=20
<div id=3D"expander-content-1082934498" class=3D"expand-content">
<br />
<p>We need to populate the meta table from the previous release to allow th=
e schema_patcher.pl script to work. The final sdiff will display the peptid=
e_align_feature_xxx tables that are in the previous release. These can be i=
gnored.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Check patches</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">mysqldump -u ensro -h compara5 -P3306 --no-data --skip-add-drop=
-table lg4_ensembl_compara_75 | sed 's/AUTO_INCREMENT=3D[0-9]*\b//' &gt; ol=
d_schema.sql
db_cmd.pl -url &quot;mysql://ensadmin:${ENSADMIN_PSW}@compara5/lg4_schema_p=
atch_test&quot; -sql 'CREATE DATABASE'
db_cmd.pl -url &quot;mysql://ensadmin:${ENSADMIN_PSW}@compara5/lg4_schema_p=
atch_test&quot; &lt; old_schema.sql
mysqldump --defaults-group-suffix=3D_compara5 lg4_ensembl_compara_75 meta |=
 db_cmd.pl -url &quot;mysql://ensadmin:${ENSADMIN_PSW}@compara5/lg4_schema_=
patch_test&quot;
$ENSEMBL_CVS_ROOT_DIR/ensembl/misc-scripts/schema_patcher.pl --host compara=
5 --port 3306 --user ensadmin --pass $ENSADMIN_PSW --database lg4_schema_pa=
tch_test --type compara --from 74 --release 75 --verbose
mysqldump --defaults-group-suffix=3D_compara5 --no-data --skip-add-drop-tab=
le lg4_schema_patch_test | sed 's/AUTO_INCREMENT=3D[0-9]*\b//' &gt;patched_=
old_schema.sql
sdiff -w 200 -bs patched_old_schema.sql new_schema.sql | less</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"54"><span>git commit table.sql and any patch fil=
es</span></li>=20
</ul>=20
<hr />
<p><span> <br /> </span></p>=20
<div class=3D"aui-message hint shadowed information-macro">=20
<span class=3D"aui-icon icon-hint">Icon</span>=20
<div class=3D"message-content">=20
<p>After Handover</p>=20
</div>=20
</div>=20
<h3 id=3D"Releasecoordinationdocumentation-RunCheckTaxonhealthcheck"><span>=
Run CheckTaxon healthcheck<br /> </span></h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"82">Run the CheckTaxon healthcheck early to find=
 any discrepancies between the ncbi_taxon_name table and the core databases=
 (information about how to set up the healthchecks can be found <a href=3D"=
http://www.ebi.ac.uk/seqdb/confluence/display/EnsCom/Release+coordination+d=
ocumentation#Releasecoordinationdocumentation-Runthehealthchecks" class=3D"=
external-link" rel=3D"nofollow">here</a>)</li>=20
</ul>=20
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Run healthcheck</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;"># make sure you are using the right version of JAVA:
export JAVA_HOME=3D/software/jdk1.6.0_14
&nbsp;
# if you need to recompile (submit to the farm, because you need more memor=
y than is available on the head) :
bsub -I ant clean jar
&nbsp;
# run the healthchecks (submit to the far(submit to the farm, because you n=
eed more memory than is available on the head) :m, because you need more me=
mory than is available on the head) :
time bsub -I ./run-configurable-testrunner.sh -h compara1 -d sf5_ensembl_co=
mpara_master -t org.ensembl.healthcheck.testcase.compara.CheckTaxon</pre>=
=20
</div>
</div>
<p>We can use the compara master database as the source, before the creatio=
n of the release database.</p>
<p><span>(see xxxx on how to set run the healthchecks)</span></p>
<h3 id=3D"Releasecoordinationdocumentation-Addnewgenome_dbtocomparamasterda=
tabase"><span>Add new genome_db to compara master database</span></h3>
<p><span>The current master database (rel.75) is called sf5_ensembl_compara=
_master on compara1.</span> You have to create new genome_dbs and dnafrags =
when there is a new assembly or a new species.<span> Any new genome_dbs, dn=
afrags and method_link_species_set_ids need to be added before production s=
tarts. <br /> </span></p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"292"><p><span>Add genome_db</s=
pan></p>=20
<div id=3D"expander-1763666479" class=3D"expand-container">=20
<div id=3D"expander-control-1763666479" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1763666479" class=3D"expand-content">
<p><span> <span>This may have already been done if the dna guys started ear=
ly, please check.</span> </span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Add genome_db</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/upd=
ate_genome.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipe=
line/production_reg_conf.pl --compara compara_master --species &quot;gadus_=
morhua&quot; --collection ensembl</pre>=20
</div>
</div>
<p><span>Add the new genome_db_id to the confluence page <a href=3D"/seqdb/=
confluence/display/EnsCom/Release+plans">Release plans</a>. This script may=
 take a while if the species you are adding is new. You can check the progr=
ess by counting dnaFrag entries in the master database:</span></p>
<pre>select count(*) from dnafrag;</pre>
<pre>&nbsp;</pre>
<pre>NB: The updated update_genome.pl should do the following automatically=
. Please check that it does, and remove the italicised text if ok:</pre>
<p><em>If it is a new genebuild and the assembly hasn't changed, you can ju=
st edit the entry in master (genome_db table) introducing the new genebuild=
 from meta.genebuild.start_date in the core database.</em></p>
<pre>            <em>update genome_db set genebuild =3D&quot;2011-07-FlyBas=
e&quot; where genome_db_id =3D 105;</em>
          </pre>
</div>=20
</div> <p><span> <span> <br /> </span> </span></p></li>=20
<li class=3D"checked" data-inline-task-id=3D"110"><p><span>Add in extra non=
-reference patches.</span> <span>&nbsp;</span></p>=20
<div id=3D"expander-1860811322" class=3D"expand-container">=20
<div id=3D"expander-control-1860811322" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1860811322" class=3D"expand-content">
<p><span>This is currently done when a new patch for either human or mouse =
is released. This may have already been done, please ask. <br /> </span></p=
>
<p><span>Details about the patches can be found here <a href=3D"ftp://ftp.n=
cbi.nlm.nih.gov/genbank/genomes/Eukaryotes/vertebrates_mammals/Homo_sapiens=
/" class=3D"external-link" rel=3D"nofollow">ftp://ftp.ncbi.nlm.nih.gov/genb=
ank/genomes/Eukaryotes/vertebrates_mammals/Homo_sapiens/</a> <br /> </span>=
</p>
<p><span>eg for patch 11:&nbsp; <a href=3D"ftp://ftp.ncbi.nlm.nih.gov/genba=
nk/genomes/Eukaryotes/vertebrates_mammals/Homo_sapiens/GRCh37.p11/README" c=
lass=3D"external-link" rel=3D"nofollow">ftp://ftp.ncbi.nlm.nih.gov/genbank/=
genomes/Eukaryotes/vertebrates_mammals/Homo_sapiens/GRCh37.p11/README</a> <=
/span></p>
<p><span> <span> <span> <span>It is first necessary to find if any patches =
have been deleted or updated since these need to be deleted from the master=
 before the new and replacement patches are added. This is done by running =
the find_assembly_patches.pl script on the new and previous release of the =
core database<br /> </span> </span> </span> </span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Find assembly patches</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/find_ass=
embly_patches.pl -new_core &quot;mysql://ensro@ens-staging1:3306/homo_sapie=
ns_core_73_37?group=3Dcore&amp;species=3Dhomo_sapiens&quot; -prev_core &quo=
t;mysql://ensro@ens-livemirror:3306/homo_sapiens_core_72_37?group=3Dcore&am=
p;species=3Dhomo_sapiens&quot;</pre>=20
</div>
</div>
<p><span> <span>The output looks like this (format: name, seq_region_id, da=
te)<br /> </span> </span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Sample ouptut</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">NEW patches
  HG29_PATCH 1001061122 2013-02-18 14:16:55
  HG1592_PATCH 1001061114 2013-02-18 14:16:55
  HG385_PATCH 1001061116 2013-02-18 14:16:55
  HSCHR6_2_CTG5 1001061112 2013-02-18 14:16:55
  HG1079_PATCH 1001061118 2013-02-18 14:16:55
CHANGED patches
  HG1436_HG1432_PATCH new=3D1001061124 2013-02-18 14:16:55        prev=3D10=
00859885 2012-10-08 16:48:36
  HG1292_PATCH new=3D1001061108 2013-02-18 14:16:55       prev=3D1000759258=
 2012-04-27 12:12:07
  HSCHR22_1_CTG1 new=3D1001061120 2013-02-18 14:16:55     prev=3D1000057052=
 2010-09-07 14:22:38
  HG1287_PATCH new=3D1001061110 2013-02-18 14:16:55       prev=3D1000859831=
 2012-10-08 16:48:36
DELETED patches
Patches to delete: (&quot;HG1436_HG1432_PATCH&quot;,&quot;HG1292_PATCH&quot=
;,&quot;HSCHR22_1_CTG1&quot;,&quot;HG1287_PATCH&quot;)</pre>=20
</div>
</div>
<p>In this case, there are 5 NEW patches, 4 CHANGED patches and no DELETED =
patches. Any CHANGED or DELETED patches must be deleted from the master bef=
ore importing the new patch set.</p>
<p><span> <span>To add extra non-reference patches to an existing assembly,=
 you need the -force option to just add those dnafrags which aren't already=
 in the database. </span> </span> <br /> <span>&nbsp;</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Add patches</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/upd=
ate_genome.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipe=
line/production_reg_conf.pl --compara compara_master --species human --forc=
e</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Addmethod_link_species_setentrie=
stocomparamasterdatabase"><span>Add method_link_species_set entries to comp=
ara master database<br /> </span></h3>
<p><span> <span>These are usually added by the people that need them, pleas=
e check.</span> </span></p>
<p>The release coordinator (or any team member) should create a new method_=
link_species_set in the master database before starting a new pipeline in o=
rder to get a unique method_link_species_set_id. Ideally they can be create=
d before starting to build the new database although new method_link_specie=
s_sets can be added later on.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"91"><p>Add dna <span>method_li=
nk_species_set entries<br /> </span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Pairwise method_link_species_set</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type LASTZ_NET --genome_db_id 90,142 --source &qu=
ot;ensembl&quot; --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/p=
ipeline/production_reg_conf.pl --compara compara_master</pre>=20
</div>
</div></li>=20
<li class=3D"checked" data-inline-task-id=3D"102"><p>Add synteny <span>meth=
od_link_species_set entries</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Synteny method_link_species_set</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/cre=
ate_mlss.pl --method_link_type SYNTENY --genome_db_id 90,142 --source &quot=
;ensembl&quot; --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pip=
eline/production_reg_conf.pl -compara compara_master</pre>=20
</div>
</div><p><br /> <span> <br /> </span></p></li>=20
<li class=3D"checked" data-inline-task-id=3D"135"><p>Add homology method_li=
nk_species_set_entries</p>=20
<div id=3D"expander-742742368" class=3D"expand-container">=20
<div id=3D"expander-control-742742368" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-742742368" class=3D"expand-content">
<p>Choose a temp. directory where the output will be generated:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Choose temp directory</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">export MLSS_DIR=3D&quot;/tmp/mlss_creation&quot;
mkdir $MLSS_DIR</pre>=20
</div>
</div>
<p>Run the loading script several times:</p>
<p>--pw stands for all pairwised genome_db_ids in the list provided</p>
<p>--sg stands for keep genome_db_id in the list alone (singleton)</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Protein method_link_species_set</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;"># orthologues
echo -e &quot;201\n&quot; | perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/create_mlss.pl --f \
--reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/productio=
n_reg_conf.pl \
--pw --collection ensembl 1&gt;$MLSS_DIR/create_mlss.ENSEMBL_ORTHOLOGUES.20=
1.out 2&gt;$MLSS_DIR/create_mlss.ENSEMBL_ORTHOLOGUES.201.err

# paralogues wth
echo -e &quot;202\n&quot; | perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/create_mlss.pl --f \
--reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/productio=
n_reg_conf.pl \
--sg --collection ensembl 1&gt;$MLSS_DIR/create_mlss.ENSEMBL_PARALOGUES.wth=
.202.out 2&gt;$MLSS_DIR/create_mlss.ENSEMBL_PARALOGUES.wth.202.err

# proteintrees
echo -e &quot;401\n&quot; | perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/create_mlss.pl --f \
--reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/productio=
n_reg_conf.pl \
--name &quot;protein trees&quot; --collection ensembl 1&gt;$MLSS_DIR/create=
_mlss.PROTEIN_TREES.401.out 2&gt;$MLSS_DIR/create_mlss.PROTEIN_TREES.401.er=
r

# nctrees
echo -e &quot;402\n&quot; | perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/create_mlss.pl --f \
--reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/productio=
n_reg_conf.pl \
--name &quot;nc trees&quot; --collection ensembl 1&gt;$MLSS_DIR/create_mlss=
.NC_TREES.402.out 2&gt;$MLSS_DIR/create_mlss.NC_TREES.402.err

# families
echo -e &quot;301\n&quot; | perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/create_mlss.pl --f \
--reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/productio=
n_reg_conf.pl \
--name &quot;families&quot; --collection ensembl 1&gt;$MLSS_DIR/create_mlss=
.FAMILY.301.out 2&gt;$MLSS_DIR/create_mlss.FAMILY.301.err</pre>=20
</div>
</div>
<p>If output/error files are ok, remove them all:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Remove files</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">rm -rf $MLSS_DIR</pre>=20
</div>
</div>
<p>Otherwise make yourself a nice cup of tea and then *PANIC*</p>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Addnewspeciestophylogenetictree"=
>Add new species to phylogenetic tree</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"116"><p><span>Add new species =
to phylogenetic tree</span></p>=20
<div id=3D"expander-1267612696" class=3D"expand-container">=20
<div id=3D"expander-control-1267612696" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1267612696" class=3D"expand-content">
<p>The easiest way to use this is to use the phylowidget.</p>
<p>From the EnsEMBL home page:</p>
<p>View full list of all Ensembl species</p>
<p>Species tree (Requires Java)</p>
<p>&nbsp;</p>
<p>Select Arrow and select where you want the new species to go (use ncbi t=
axonomy or wikipedia etc) eg Gadus morhua</p>
<p>Then select in the menu &quot;Tree Edit &gt; Add &gt; Sister&quot;</p>
<p>Click on the empty node and edit name (add new name) and branch length</=
p>
<p>&nbsp;</p>
<p>The tree should appear in the Toolbox but if not, then save the tree</p>
<p>Copy the new tree into</p>
<p>&nbsp;&nbsp;&nbsp; $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipelin=
e/species_tree_blength.nh</p>
<p>git commit</p>
<p>&nbsp;</p>
<p>## rel.65 -- Added Gadus morhua</p>
<p>## rel.66 -- Added Latimeria chalumnae (Coelacanth)</p>
<p>## Also included 'ensembl timetree mya' in ncbi_taxa_name for</p>
<p>## taxon_id: 8287 -- value: 414.9 in the master and final database.</p>
<p>## rel.69 added Xiphophorus_maculatus and Mustela_putorius_furo</p>
</div>=20
</div> <p><span> <br /> </span></p></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Finalcheckstocomparamasterdataba=
se">Final checks to compara master database</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"96">Check if any new species h=
ave been postponed<br />If a new species is postponed for&nbsp; this releas=
e, check that no entries (genome_db, dnafrags, etc) were added to the maste=
r database. If they were, you can simply switch the assembly_default value =
in the genome_db table.&nbsp;<br />[1] for species making it / used in the =
pipeline<br />[0] for species not making it / or old assemblies</li>=20
<li class=3D"checked" data-inline-task-id=3D"376"><p>Check that all the new=
 species have been added to the 'ensembl' collection:</p>=20
<div id=3D"expander-1506342991" class=3D"expand-container">=20
<div id=3D"expander-control-1506342991" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details...</span>=20
</div>=20
<div id=3D"expander-content-1506342991" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">select name from species_set_tag join species_set using(species_=
set_id) join genome_db using(genome_db_id) where value like 'collection-ens=
embl' order by genome_db_id;</pre>=20
</div>
</div>
</div>=20
</div> <p>&nbsp;</p><p>&nbsp;</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"155"><p>Drop method_link_speci=
es_set entries for alignments which did not make it.</p>=20
<div id=3D"expander-1891997915" class=3D"expand-container">=20
<div id=3D"expander-control-1891997915" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1891997915" class=3D"expand-content">
<p>Check with other members of compara. Remove redundant entries.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>mlss</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">SELECT ml.* FROM method_link ml LEFT JOIN method_link_species_s=
et mlss ON ml.method_link_id=3Dmlss.method_link_id WHERE mlss.method_link_i=
d IS NULL;</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-CreateReleaseDatabase">Create Re=
lease Database</h3>
<p>Create the new database for the new release and add it to your registry =
configuration file. Use the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/sql/table=
.sql file to create the tables and populate the database with the relevant =
primary data and genomic alignments that can be reused from the previous re=
lease. This can be done with the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scri=
pts/pipeline/populate_new_database.pl script.&nbsp; It requires the master =
database, the previous released database and the fresh new database with th=
e tables already created. The script will copy relevant data from the maste=
r and the old database into the new one.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"348"><p><span>Create new datab=
ase</span></p>=20
<div id=3D"expander-307110117" class=3D"expand-container">=20
<div id=3D"expander-control-307110117" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-307110117" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Create database</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">db_cmd.pl $COMPARA_REG compara_curr -sql &quot;CREATE DATABASE&=
quot;
db_cmd.pl $COMPARA_REG compara_curr &lt; $ENSEMBL_CVS_ROOT_DIR/ensembl-comp=
ara/sql/table.sql=20
</pre>=20
</div>
</div>
</div>=20
</div> <p>&nbsp;</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"428"><p><span>Populate the new=
 database</span></p>=20
<div id=3D"expander-1152567792" class=3D"expand-container">=20
<div id=3D"expander-control-1152567792" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1152567792" class=3D"expand-content">
<p>Before you start copying, make a dry run of the populate_new_database.pl=
 with -intentions flag to review the list of mlss_ids to be copied:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>populate_new_database intentions</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/populate=
_new_database.pl --reg-conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/p=
ipeline/production_reg_conf.pl \=20
--master compara_master --old compara_prev --new compara_curr --intentions =
&gt; populate_new_database.intentions</pre>=20
</div>
</div>
<p>This takes about a minute and produces a long list.</p>
<p>If you believe some of the entries should NOT be copied, you should manu=
ally add 'skip_mlss' and 'skip_ss' entries into master database meta table.=
</p>
<p>NB There are cases where the mlss does not change but the underlying dat=
a does eg the &quot;patch-to-ref&quot; alignment (H.sap-H.sap lastz-patch a=
nd M.mus-M.mus lastz-patch). These have a mlss_id of 556 (H.sap)&nbsp; and =
624 (M.mus) and are currently set in the skip_mlss. If there are no new pat=
ches, this needs to be removed to allow the existing data to be copied. If =
there are new patches, please ensure the 'skip_mlss' is set in the meta tab=
le. However, the entry in the method_link_species_set table will not be cop=
ied and will need to be added manually.</p>
<p>Start the copying:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>populate_new_database</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pop=
ulate_new_database.pl \
    --reg-conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/produ=
ction_reg_conf.pl --master compara_master --old compara_prev --new compara_=
curr &gt; populate_new_database.out</pre>=20
</div>
</div>=20
<div id=3D"expander-415516714" class=3D"expand-container">=20
<div id=3D"expander-control-415516714" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for run times</span>=20
</div>=20
<div id=3D"expander-content-415516714" class=3D"expand-content">
<p>took 3 hours for rel.pre57 (copied from rel.56)</p>
<p>took 3 hours for rel.57 (copied from rel.pre57)</p>
<p>took 2:15 hours for rel.58 (copied from rel.57)</p>
<p>took 2:09 hours for rel.59 (copied from rel.58)</p>
<p>took 3 hours for rel. 60 (copied from rel.59)</p>
<p>rel.64:&nbsp;&nbsp; 2.6h</p>
<p>rel.65:&nbsp;&nbsp; 2.5h</p>
<p>rel.66:&nbsp;&nbsp; 4.8h</p>
<p>rel.67:&nbsp;&nbsp; 2.1h (launched from compara3)</p>
<p>rel.68:&nbsp;&nbsp; 1h40m (run on compara3)</p>
<p>rel.69:&nbsp;&nbsp; 2.5h</p>
<p>rel.70:&nbsp;&nbsp; ~3.5h (compara1 was slow)</p>
<p>rel.71:&nbsp;&nbsp;&nbsp; 4.1h (compara3)</p>
<p>rel.72: &nbsp; 5.1h (compara3)</p>
<p>rel.73: 5.5h (compara2)</p>
<p>rel.74: 2h:3' (compara3)</p>
<p>rel.75: 5.5h (compara5)</p>
<p>rel77: 9.7hr(compara5)</p>
</div>=20
</div>=20
<p>If new method_link_species_sets are added in the master after this, you =
use this script again to copy the new relevant data. In such case, you will=
 have to:</p>
<p>&nbsp;- skip the old_database in order to avoid trying to copy the dna-d=
na alignments and syntenies again</p>
<p>&nbsp;- empty ncbi_taxa_name before running</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>populate_new_database from master only</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/populate=
_new_database.pl \
    --reg-conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/produ=
ction_reg_conf.pl --master compara_master --new compara_curr</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul> </li>=20
<li class=3D"checked" data-inline-task-id=3D"236"><p>Delete any pairwise al=
ignments on non-reference patches that have been DELETED or UPDATED.</p>=20
<div id=3D"expander-734038802" class=3D"expand-container">=20
<div id=3D"expander-control-734038802" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-734038802" class=3D"expand-content">
<p>For the UPDATED patches, you need to use the original dnafrag_ids (ask C=
ompara members who ran the alignments on patches - usually Kathryn).</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>delete patches</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">SELECT count(*) FROM genomic_align ga1, genomic_align ga2, geno=
mic_align_block gab WHERE ga1.dnafrag_id in (13768162,13728785,13768189,129=
67785) AND ga1.genomic_align_block_id =3D ga2.genomic_align_block_id AND ga=
1.genomic_align_id !=3D ga2.genomic_align_id AND  ga1.genomic_align_block_i=
d =3D gab.genomic_align_block_id;
99906

DELETE ga1, ga2, gab FROM genomic_align ga1, genomic_align ga2, genomic_ali=
gn_block gab WHERE ga1.dnafrag_id in (13768162,13728785,13768189,12967785) =
AND ga1.genomic_align_block_id =3D ga2.genomic_align_block_id AND ga1.genom=
ic_align_id !=3D ga2.genomic_align_id AND ga1.genomic_align_block_id =3D ga=
b.genomic_align_block_id;
Query OK, 299718 rows affected (34.34 sec)
99906*3=3D299718</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li data-inline-task-id=3D"433"><p>Run healthchecks on the release database=
</p>=20
<div id=3D"expander-1482036080" class=3D"expand-container">=20
<div id=3D"expander-control-1482036080" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1482036080" class=3D"expand-content">
<p>Run the healthchecks to make sure the the release database is consistent=
 after the initial population of data.</p>
<p>Click <a href=3D"http://www.ebi.ac.uk/seqdb/confluence/display/EnsCom/Re=
lease+coordination+documentation#Releasecoordinationdocumentation-Runthehea=
lthchecks" class=3D"external-link" rel=3D"nofollow">here</a> for how to set=
up and run the healthchecks</p>
<p>Run the compara_external_foreign_keys healthcheck</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>healthcheck</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cd $ENSEMBL_CVS_ROOT_DIR/ensj-healthcheck
&nbsp;
# make sure you are using the right version of JAVA:
export JAVA_HOME=3D/software/jdk1.6.0_14
=20
# if you need to recompile (submit to the farm, because you need more memor=
y than is available on the head) :
bsub -I ant clean jar

# some tests need more memory than the farm3's default:
time bsub -q yesterday -M8000  -R&quot;select[mem&gt;8000]  rusage[mem=3D80=
00]&quot; -I ./run-configurable-testrunner.sh -h compara5 -d sf5_ensembl_co=
mpara_77 --host2 ens-staging2 -g ComparaExternalForeignKeys</pre>=20
</div>
</div>
<p>and correct any problems, if any</p>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-MergeDNAdata">Merge DNA data</h3=
>
<p>NOTE: All the runs of copy_data.pl (except the last one) should have the=
 flag &quot;-re_enable 0&quot; to avoid constantly recomputing the indices<=
/p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"366"><p><span>Pairwise alignme=
nts: LASTZ_NET, BLASTZ_NET, TRANSLATED_BLAT_NET and the special case of LAS=
TZ_PATCH.</span></p><p>*NOTE* : For merging pw alignments involving haploty=
pes, go to the next point</p>=20
<div id=3D"expander-39120227" class=3D"expand-container">=20
<div id=3D"expander-control-39120227" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-39120227" class=3D"expand-content">
<p>These data are usually in separate production databases. You can copy th=
em using the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl script. This script requires write access to the production database =
if the dnafrag_ids need fixing. Use the flag -re_enable 0 on all calls apar=
t from the last one to avoid recomputing the indices.</p>
<p>Example:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">    # for each source URL: first plug in the --from_url and add=
 --dry_run to check that the script has found the right MLSS:
$ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_data.pl --reg_c=
onf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/production_reg_c=
onf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET --re_enable =
0 --from_url mysql://ensadmin:${ENSADMIN_PSW}@compara4/sf5_ggal_falb_lastz_=
73 --dry_run
&nbsp;
    # if happy, remove the --dry_run flag and run it again, preferably on t=
he farm:
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000 -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_dat=
a.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/prod=
uction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET =
--re_enable 0 --from_url mysql://ensadmin:${ENSADMIN_PSW}@compara4/sf5_ggal=
_falb_lastz_73
&nbsp;
    # sometimes you will also need to copy Human_ref_vs_Human_patches (note=
 the method_link_type is LASTZ_PATCH !)&nbsp;
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000  -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pro=
duction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_PAT=
CH --re_enable 0 --from_url mysql://ensadmin:${ENSADMIN_PSW}@compara3/sf5_c=
ompara_human_lastz_patch_and_haplotype_73

</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li data-inline-task-id=3D"302"><p>Pairwise alignments: non-reference patch=
es for the high coverage LASTZ_NET alignments. This is ito be used when mer=
ging pw alignments involving haplotypes.</p>=20
<div id=3D"expander-1398291413" class=3D"expand-container">=20
<div id=3D"expander-control-1398291413" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1398291413" class=3D"expand-content">
<p>This step is now very similar to the previous.</p>
<p>Do not forget --merge and --patch_merge options.</p>
<p>Also, if it's the last one you might want to switch keys back on</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data --merge</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">    # first plug in the --from_url and add --dry_run to check t=
hat the script has found the right MLSS:
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000  -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pro=
duction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET=
 --method_link_type BLASTZ_NET --method_link_type TRANSLATED_BLAT_NET --re_=
enable 1 --merge --patch_merge --from_url mysql://ensadmin:${ENSADMIN_PSW}@=
compara2/kb3_hsap_lastz_hap_73 --dry_run
&nbsp;
    # if happy, remove the --dry_run flag and run it again, preferably on t=
he farm:
bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=3D5000]&quot; -M5=
000  -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/pro=
duction_reg_conf.pl --to_reg_name compara_curr --method_link_type LASTZ_NET=
 --method_link_type BLASTZ_NET --method_link_type TRANSLATED_BLAT_NET --re_=
enable 1 --merge --patch_merge --from_url mysql://ensadmin:${ENSADMIN_PSW}@=
compara2/kb3_hsap_lastz_hap_73</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"304"><p><span>Multiple alignme=
nts: PECAN, EPO, EPO_LOW_COVERAGE, GERP_CONSTRAINED_ELEMENT, GERP_CONSERVAT=
ION_SCORE</span></p>=20
<div id=3D"expander-1610997384" class=3D"expand-container">=20
<div id=3D"expander-control-1610997384" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1610997384" class=3D"expand-content">
<p>These data are usually in separate production databases. You can copy th=
em using the $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_da=
ta.pl script. This script requires write access to the production database =
if the dnafrag_ids need fixing or the data must be copied in binary mode (t=
his is required for conservation scores).</p>
<p>Some alignments produce conservation scores and constrained elements (ch=
eck the&nbsp;<a href=3D"/seqdb/confluence/display/EnsCom/Release+plans">Rel=
ease plans</a>) and these need to be copied separately.</p>
<p>eg</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_data multiple alignment</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">    bsub -q yesterday -R &quot;select[mem&gt;5000] rusage[mem=
=3D5000]&quot; -M5000 \
    -I time $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/copy_dat=
a.pl \
    --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pipeline/produ=
ction_reg_conf.pl --to_reg_name compara_curr \
    --method_link_type EPO --method_link_type EPO_LOW_COVERAGE --method_lin=
k_type PECAN \
    --method_link_type GERP_CONSTRAINED_ELEMENT --method_link_type GERP_CON=
SERVATION_SCORE \
    --from_url mysql://ensadmin:${ENSADMIN_PSW}@compara2/sf5_epo_low_8way_f=
ish_71 -re_enable 0

</pre>=20
</div>
</div>
<p>EPO alignments produce ancestral sequences and a separate core database =
which must also be copied. See below.</p>=20
<div id=3D"expander-1175142078" class=3D"expand-container">=20
<div id=3D"expander-control-1175142078" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for run times</span>=20
</div>=20
<div id=3D"expander-content-1175142078" class=3D"expand-content">
<p>rel 71.</p>
<p>2m: kb3_hsap_ggal_lastz_71&nbsp; mlss_id=3D632</p>
<p>1m&nbsp; kb3_mmus_ggal_lastz_71&nbsp; mlss_id=3D633</p>
<p>1m&nbsp; kb3_ggal_mgap_lastz_71&nbsp; mlss_id=3D634</p>
<p>1m&nbsp; kb3_ggal_xtro_tblat_71&nbsp; mlss_id=3D638</p>
<p>1m&nbsp; kb3_hsap_ggal_tblat_71&nbsp; mlss_id=3D637</p>
<p>1m&nbsp; sf5_olat_gmor_lastz_71&nbsp; mlss_id=3D625</p>
<p>3m&nbsp; kb3_pecan_20way_71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mlss_id=3D630<=
/p>
<p>4m&nbsp; kb3_pecan_20way_71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mlss_id=3D631<=
/p>
<p>35m&nbsp; kb3_pecan_20way_71&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mlss_id=3D500=
45</p>
<p>3m&nbsp; sf5_compara_epo_6way_71 mlss_id=3D548</p>
<p>1m&nbsp; sf5_olat_onil_lastz_71&nbsp; mlss_id=3D626</p>
<p>1m&nbsp; sf5_olat_xmac_lastz_71&nbsp; mlss_id=3D627</p>
<p>1m&nbsp; sf5_epo_low_8way_fish_71 mlss_id=3D628</p>
<p>2m&nbsp; sf5_epo_low_8way_fish_71 mlss_id=3D629</p>
<p>9m&nbsp; sf5_epo_low_8way_fish_71 mlss_id=3D50044</p>
<p>1m&nbsp; kb3_ggal_drer_tblat_71&nbsp;&nbsp; mlss_id=3D639</p>
<p>1m&nbsp; kb3_ggal_csav_tblat_71&nbsp;&nbsp; mlss_id=3D640</p>
<p>1m&nbsp; sf5_ggal_acar_lastz_71&nbsp;&nbsp; mlss_id=3D636</p>
<p>91m&nbsp; sf5_ggal_tgut_lastz_7&nbsp;&nbsp;&nbsp; mlss_id=3D635 (re-enab=
le 1)</p>
<p>93m&nbsp; sf5_compara_epo_3way_birds_71 mlss_id=3D641 (re-enable 1)</p>
<p>14m&nbsp; sf5_compara_epo_3way_birds_71 mlss_id=3D642 (re-enable 1)</p>
<p>16m&nbsp; sf5_compara_epo_3way_birds_71 mlss_id=3D50046 (re-enable 1)</p=
>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"403"><p>Check the keys have be=
en re-enabled</p>=20
<div id=3D"expander-1468936074" class=3D"expand-container">=20
<div id=3D"expander-control-1468936074" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1468936074" class=3D"expand-content">
<p>Use mysqlshow to highlight if the table still has disabled keys. The tex=
t &quot;disabled&quot; will be shown in the Comment column if the key is di=
sabled. An empty Comment column indicates the keys are enabled.</p>
<p>mysqlshow interprets any underscores in the last argument as a wildcard =
so to get round this, we need to use % as the last argument.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>mysqlshow</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">eval mysqlshow `db_cmd.pl $COMPARA_REG compara_curr -to_params`=
 --keys genomic_align_block %
eval mysqlshow `db_cmd.pl $COMPARA_REG compara_curr -to_params` --keys geno=
mic_align %
eval mysqlshow `db_cmd.pl $COMPARA_REG compara_curr -to_params` --keys geno=
mic_align_tree %
eval mysqlshow `db_cmd.pl $COMPARA_REG compara_curr -to_params` --keys cons=
ervation_score %
eval mysqlshow `db_cmd.pl $COMPARA_REG compara_curr -to_params` --keys cons=
trained_element %</pre>=20
</div>
</div>
<p>If there are still tables with keys disabled run the following on them:<=
/p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">db_cmd.pl $COMPARA_REG compara_curr -sql &quot;ALTER TABLE &lt;t=
able_name&gt; ENABLE KEYS&quot;;</pre>=20
</div>
</div>
</div>=20
</div> <p><span>&nbsp;</span> <span> <br /> </span></p></li>=20
<li class=3D"checked" data-inline-task-id=3D"370"><p><span>Syntenies</span>=
</p>=20
<div id=3D"expander-1378156292" class=3D"expand-container">=20
<div id=3D"expander-control-1378156292" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1378156292" class=3D"expand-content">
<p>First make sure the entries in $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scr=
ipts/pipeline/production_reg_conf.pl file point at the latest (staging) ver=
sions of the core databases.</p>
<p>Load the synteny data by running the $ENSEMBL_CVS_ROOT_DIR/ensembl-compa=
ra/scripts/synteny/LoadSytenyData.pl script. This requires a synteny file. =
The location of this should be on the <a href=3D"/seqdb/confluence/display/=
EnsCom/Release+plans">Release plans</a>.</p>
<p>The &quot;-ref&quot; and &quot;-nonref&quot; species should be taken fro=
m the name of the method_link_species_set that corresponds to the pairwise =
alignments containing both species</p>
<p>Example</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>load synteny data</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/synteny/Load=
SyntenyData.pl --reg_conf $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/pip=
eline/production_reg_conf.pl \
    --dbname compara_curr -ref &quot;Homo sapiens&quot; -nonref &quot;Calli=
thrix jacchus&quot; -mlss_id 10052 \
    /lustre/scratch101/ensembl/kb3/scratch/hive/release_64/kb3_hsap_cjac_sy=
nteny_64/synteny/all.100000.100000.BuildSynteny</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"394"><p><span>Ancestral sequen=
ce core database</span></p>=20
<div id=3D"expander-1786806816" class=3D"expand-container">=20
<div id=3D"expander-control-1786806816" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1786806816" class=3D"expand-content">
<p>Putting together the database of ancestral sequence is now done using a =
dedicated Hive-Core mini-pipeline.</p>
<p>Check you have the most recent core checkout ie the correct schema and p=
atch files are added to the meta table.</p>
<p>&nbsp;&nbsp;&nbsp; Go to $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/modules/B=
io/EnsEMBL/Compara/PipeConfig and open the PipeConfig file AncestralMerge_c=
onf.pm .</p>
<p>&nbsp;&nbsp;&nbsp; Make sure you have edited/checked the following:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1) current release number</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2) names and locations of cur=
rent and previous ancestral core databases</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 3) the table of ancestral seq=
uence sources in the second analysis (some entries might point to the previ=
ous release ancestral database, some will be new)</p>
<p>&nbsp;&nbsp;For (3), you can run the following query on your release dat=
abase and on the previous database: (NB: method_link_id=3D13 is equivalent =
to method_link_type =3D &quot;EPO&quot;)</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>EPO query</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">SELECT * FROM method_link_species_set WHERE method_link_id =3D =
13; </pre>=20
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; The new mlss_id should be attached to the=
ir production database:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbs=
p; '641' =3D&gt; '<a rel=3D"nofollow">mysql://ensadmin:$ENSADMIN_PSW@compar=
a3/sf5_3birds_ancestral_sequences_core_71</a>' <br />&nbsp;&nbsp;&nbsp;&nbs=
p;&nbsp; The mlss_id that are reused should be linked to the previous datab=
ase<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; '505' =3D&gt; $se=
lf-&gt;o('prev_ancestral_db'),</p>
<p>The current (as or rel.75) list of ancestral alignments are:</p>
<p>5 teleost fish<br /> 6 primates<br /> 4 sauropsids (&quot;birds&quot;)<b=
r /> 15 eutherian mammals</p>
<p>Save the changes, exit the editor and run init_pipeline.pl with this fil=
e:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>init_pipeline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl AncestralMerge_conf.pm -host compara5</pre>=20
</div>
</div>
<p>Then run both -sync and -loop variations of the beekeeper.pl command sug=
gested by init_pipeline.pl . This pipeline will merge the separate ancestra=
l core sources into ensembl_ancestral_{rel_number}.</p>
<p>You may want to check the msg table for errors and have a look at the re=
sult of the merger:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Which Ancestral sequences do we have?</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">SELECT left(name,12) na, count(*), min(seq_region_id), max(seq_=
region_id), max(seq_region_id)-min(seq_region_id)+1 FROM seq_region GROUP B=
Y na;</pre>=20
</div>
</div>
<p>If everything is ok,&nbsp;measure the time:</p>
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>how much time did running of the pipeline take?</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">call time_analysis('%')&nbsp;</pre>=20
</div>
</div>=20
<div id=3D"expander-108063386" class=3D"expand-container">=20
<div id=3D"expander-control-108063386" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for run times</span>=20
</div>=20
<div id=3D"expander-content-108063386" class=3D"expand-content">
<p>rel.67: 20min<br />rel.71: 20min<br />rel.75: 21min</p>
</div>=20
</div>=20
<p>Then drop hive-specific tables:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>drop hive tables</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">CALL drop_hive_tables;</pre>=20
</div>
</div>
<p>Make sure all tables are myISAM.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">&nbsp;SHOW TABLE STATUS where engine !=3D 'MyISAM';</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-MergeGeneTrees+Families+NCTrees+=
PatchProjectionsAsHomologies">Merge GeneTrees+Families+NCTrees+PatchProject=
ionsAsHomologies</h3>
<p>&nbsp;</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"141">Check that CAFE has been =
run on the ProteinTrees and NCTrees</li>=20
<li class=3D"checked" data-inline-task-id=3D"425"><p>Check that LRGs were i=
ncluded in the Families</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"307">Check that PatchProjectio=
nsAsHomologies (that includes loading DisplayLabels+Descriptions) pipeline =
has been run</li>=20
<li class=3D"checked" data-inline-task-id=3D"388"><p><span>Run the Hive pip=
eline (&nbsp;MergeDBsIntoRelease_conf )&nbsp;to merge tables from all the f=
our products into the release database<br /> </span></p>=20
<div id=3D"expander-888592117" class=3D"expand-container">=20
<div id=3D"expander-control-888592117" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-888592117" class=3D"expand-content">
<p>Go to $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/modules/Bio/EnsEMBL/Compara/=
PipeConfig and open the PipeConfig file MergeDBsIntoRelease_conf.pm</p>
<p>&nbsp;&nbsp;&nbsp; It has&nbsp;a 'urls' hash where you will have to chan=
ge the names of the databases and possibly their locations:</p>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;">&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; master_db&nbsp;&nbsp;&nbsp; - is the main compara maste=
r</p>
<div>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;">&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; prev_rel_db&nbsp;&nbsp; - should point to the previous =
release database</p>
</div>
<div>
<div>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;">&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; curr_rel_db&nbsp;&nbsp; - should point to the current r=
elease database being merged into ( not the Hive pipeline database, but pur=
ely Compara schema product )</p>
</div>
</div>
<div>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protein_db - should point to the=
 current GeneTrees pipeline database
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; family_db&nbsp; - should poin=
t to the current Families pipeline database</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ncrna_db&nbsp;&nbsp; - should=
 point to the current ncRNAtrees pipeline database</p>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;">&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp;&nbsp; projection_db&nbsp;&nbsp; - should point to the current=
 PatchProjectionsAsHomologies pipeline database.</p>
<p style=3D"font-size: 10.0pt;line-height: 13.0pt;color: rgb(0,0,0);font-we=
ight: normal;margin-bottom: 10.0px;padding: 0.0px;">Also choose the server =
to run the merging pipeline on ( you don't need a lot of resources or memor=
y, as it is purely Hive book-keeping ) and set the 'host' default_option.</=
p>
<p>&nbsp;&nbsp;&nbsp; Save the changes, exit the editor, init and run the m=
erging pipeline with this file:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>running the merging pipeline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl MergeDBsIntoRelease_conf.pm
&nbsp;
beekeeper.pl ... -sync
&nbsp;
beekeeper.pl ... -loop</pre>=20
</div>
</div>
<p>&nbsp;&nbsp;&nbsp; This pipeline will merge all the protein-side product=
s into the release database.</p>
<p>&nbsp;</p>=20
<div id=3D"expander-215946853" class=3D"expand-container">=20
<div id=3D"expander-control-215946853" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-215946853" class=3D"expand-content">
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=
&nbsp;&nbsp;&nbsp;&nbsp;rel.73 was the first experimental run, code had to =
be fixed, servers had to be reconfigured, so merging took one whole working=
 day.</p>
<p>In the merging database run: call time_analysis('%');</p>
<p>rel.75 : 5 hours<br />rel.76 : 5.6 hours</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
</ul>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"392"><p>Add the LRG dnafrags</=
p>=20
<div id=3D"expander-385668747" class=3D"expand-container">=20
<div id=3D"expander-control-385668747" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-385668747" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">mysql.d compara2 lg4_families_77 dnafrag -t --where 'coord_syst=
em_name =3D &quot;lrg&quot;' | mysql.l compara5 sf5_ensembl_compara_77</pre=
>=20
</div>
</div>
</div>=20
</div> <p>&nbsp;</p><p>&nbsp;</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"432"><p><span>Populate the mem=
ber_production_counts table</span></p>=20
<div id=3D"expander-1097169401" class=3D"expand-container">=20
<div id=3D"expander-control-1097169401" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1097169401" class=3D"expand-content">
<p class=3D"_mce_tagged_br">Populate the member_production_counts table usi=
ng the script at $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/production/p=
opulate_member_production_counts_table.sql</p>
<p class=3D"_mce_tagged_br">time db_cmd.pl $COMPARA_REG compara_curr &lt; $=
ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/production/populate_member_pro=
duction_counts_table.sql</p>
<p>&nbsp;</p>=20
<div id=3D"expander-2107290231" class=3D"expand-container">=20
<div id=3D"expander-control-2107290231" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-2107290231" class=3D"expand-content">
<p>rel.73: 75min<br />rel.75: 43min<br />rel.76: 30min</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
</ul>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"150"><p><span>Clean up the mer=
ging database</span></p>=20
<div id=3D"expander-4251399" class=3D"expand-container">=20
<div id=3D"expander-control-4251399" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-4251399" class=3D"expand-content">
<p>After you are happy about the result of protein side merging you can dro=
p the &quot;yourname_pipeline_dbmerge_75&quot; database.</p>
</div>=20
</div> <p><span> <br /> </span></p></li>=20
<li class=3D"checked" data-inline-task-id=3D"272"><p><span>git commit the c=
hanges to the PipeConfig files that you have made.</span></p></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Finaldatabasechecks"><span>Final=
 database checks<br /> </span></h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"157"><p><span>Remove redundant=
 method_link entries</span></p>=20
<div id=3D"expander-1563470776" class=3D"expand-container">=20
<div id=3D"expander-control-1563470776" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1563470776" class=3D"expand-content">
<p>In most cases they can be removed, but check with other members of Compa=
ra. Remove redundant method_link entries</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>method_link entries</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: sql; gutter: false" style=3D"font-s=
ize:12px;">SELECT ml.* FROM method_link ml LEFT JOIN method_link_species_se=
t mlss USING(method_link_id) WHERE mlss.method_link_id IS NULL;
DELETE ml FROM method_link ml LEFT JOIN method_link_species_set mlss USING(=
method_link_id) WHERE mlss.method_link_id IS NULL;</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"198"><p>Check that all the sch=
ema patches have been declared and applied.</p>=20
<div id=3D"expander-1229210158" class=3D"expand-container">=20
<div id=3D"expander-control-1229210158" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1229210158" class=3D"expand-content">
<p>If unsure, recheck the current schema against the previous schema. See<s=
pan> <span class=3D"confluence-link">Check the patch files</span> for detai=
ls </span></p>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Runthehealthchecks"><span>Run th=
e healthchecks</span></h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"434"><p><span>Update the code<=
/span></p>=20
<div id=3D"expander-1297159779" class=3D"expand-container">=20
<div id=3D"expander-control-1297159779" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1297159779" class=3D"expand-content">
<p>The healthchecks are written in java and need to be recompiled after a g=
it pull.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>compile healthchecks</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cd $ENSEMBL_CVS_ROOT_DIR/ensj-healthcheck
export JAVA_HOME=3D/software/jdk1.6.0_14
bsub -I ant clean jar</pre>=20
</div>
</div>
<p>We don't need to configure a database.properties any more. Everythin is =
done from the command line</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"396"><p>&nbsp;Run the healthch=
ecks for ancestral database</p>=20
<div id=3D"expander-1847364802" class=3D"expand-container">=20
<div id=3D"expander-control-1847364802" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1847364802" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -M8000  -R&quot;select[mem&gt;8000]  rusage[mem=3D800=
0]&quot; -I ./run-configurable-testrunner.sh -h compara5 -d sf5_ensembl_anc=
estral_77 -g ComparaAncestral</pre>=20
</div>
</div>=20
<div id=3D"expander-645487073" class=3D"expand-container">=20
<div id=3D"expander-control-645487073" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-645487073" class=3D"expand-content">
<p># rel.62: 4sec, all successful<br /># rel.63: 14sec, all successful afte=
r analyzing 3 tables<br /># rel.65: 13sec, all successful after analyzing t=
he tables.<br /># rel.67: 8sec, all successful<br /># rel.68: 8sec, all suc=
cessful<br /># rel.71: 10sec all successful apart from UTR.java (ignore)<br=
 /># rel.75: 20sec, all successful after analyzing 3 tables</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"435"><p><span>Update the max_a=
lignment_length IF NECESSARY.</span></p>=20
<div id=3D"expander-1314690357" class=3D"expand-container">=20
<div id=3D"expander-control-1314690357" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1314690357" class=3D"expand-content">
<p>Check that the max_alignment_lengths have been computed.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update max_alignment_length</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagMax=
Align</pre>=20
</div>
</div>
<p>If not (the healthcheck is failing), you can repair it by adding the --r=
epair flag:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update max_alignment_length</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagMax=
Align --repair 1</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"386"><p>Update the alignment m=
lss_id of the conservation score IF NECESSARY</p>=20
<div id=3D"expander-1400695081" class=3D"expand-container">=20
<div id=3D"expander-control-1400695081" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1400695081" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update conservation score mlss_id</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagGER=
PMSA</pre>=20
</div>
</div>
<p>If the healthcheck is failing, you can repair it by adding the --repair =
flag:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update conservation score mlss_id</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 -t org.ensembl.healthcheck.testcase.compara.MLSSTagGER=
PMSA --repair 1</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"436"><p>Run the compara_extern=
al_foreign_keys healthcheck</p>=20
<div id=3D"expander-1036645989" class=3D"expand-container">=20
<div id=3D"expander-control-1036645989" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1036645989" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>compara_external_foreign_keys</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -q yesterday -M8000  -R&quot;select[mem&gt;8000]  rus=
age[mem=3D8000]&quot; -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 --host2 ens-staging2 -g ComparaExternalForeignKeys</pr=
e>=20
</div>
</div>=20
<div id=3D"expander-1436223264" class=3D"expand-container">=20
<div id=3D"expander-control-1436223264" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for previous results</span>=
=20
</div>=20
<div id=3D"expander-content-1436223264" class=3D"expand-content">
<p>rel.56 everything passed apart from CheckTaxon - according to Javier in =
this particular case it was not a problem<br />rel.pre57 it took 20 minutes=
 (all passed).<br />rel.57 it took ?? minutes ('genbank common name' for 4 =
species had to be copied from their 'ensembl common name' in ncbi_taxa_name=
 table)<br />rel.58:&nbsp;&nbsp; 22m<br />rel.61:&nbsp;&nbsp; 32m, 1 failur=
e<br />rel.63:&nbsp;&nbsp; 23m, 1 failure ( taeniopygia_guttata_core_63_1: =
common_name::zebra finch is not in lg4_ensembl_compara_63 )<br />rel.65:&nb=
sp;&nbsp; 25m, 1 failure ( taeniopygia_guttata_core_65_1: common_name::zebr=
a finch is not in mp12_ensembl_compara_65 )<br />rel.66:&nbsp;&nbsp; 12m, 1=
 failure ( taeniopygia_guttata_core_66_1: common_name::zebra finch is not i=
n mp12_ensembl_compara_66 )<br />rel.71.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp=
;&nbsp;&nbsp; 1 failure (ncbi_taxa_name: Lepidion inosimae: common_name &qu=
ot;Morid cod&quot; and &quot;morid cod&quot;, this was agreed to be OK in r=
el.70).<br />rel.72&nbsp; 12m<br />rel.73 12.5m</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"325"><p>Run the compara_genomi=
c healthcheck</p>=20
<div id=3D"expander-1539298303" class=3D"expand-container">=20
<div id=3D"expander-control-1539298303" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1539298303" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>compara_genomic</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -q yesterday -M8000  -R&quot;select[mem&gt;8000]  rus=
age[mem=3D8000]&quot; -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 --host2 ens-staging2 -g ComparaGenomic</pre>=20
</div>
</div>=20
<div id=3D"expander-374020643" class=3D"expand-container">=20
<div id=3D"expander-control-374020643" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for previous results</span>=
=20
</div>=20
<div id=3D"expander-content-374020643" class=3D"expand-content">
<p>rel.58:&nbsp;&nbsp; 47m, 7 failures<br />rel.61:&nbsp;&nbsp; 51m, 3 fail=
ures<br />rel.63:&nbsp;&nbsp; 84m, (2.5 errors that are &quot;ok&quot;)<br =
/>rel.65:&nbsp;&nbsp; 75m, (5 errors that are &quot;ok&quot;)<br />rel.66:&=
nbsp;&nbsp; 23m, (4 errors that are &quot;ok&quot;)<br />rel.72: 57m<br />r=
el.73 43m</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"318"><p>Run the compara_homolo=
gy healthcheck</p>=20
<div id=3D"expander-1183475442" class=3D"expand-container">=20
<div id=3D"expander-control-1183475442" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1183475442" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>compara_homology</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time bsub -q yesterday -M8000  -R&quot;select[mem&gt;8000]  rus=
age[mem=3D8000]&quot; -I ./run-configurable-testrunner.sh -h compara5 -d sf=
5_ensembl_compara_77 --host2 ens-staging2 -g ComparaHomology</pre>=20
</div>
</div>=20
<div id=3D"expander-10682746" class=3D"expand-container">=20
<div id=3D"expander-control-10682746" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for previous results</span>=
=20
</div>=20
<div id=3D"expander-content-10682746" class=3D"expand-content">
<p>rel.58:&nbsp;&nbsp; 14m, 5 failures<br />rel.61:&nbsp;&nbsp; 30m, 3 fail=
ures<br />rel.62:&nbsp;&nbsp; 3m, 1 failure (CheckSpeciesSetTag, ok?)<br />=
rel.63:&nbsp;&nbsp; 52m, success (after some fixing, of course)<br />rel.65=
:&nbsp;&nbsp; 48m, 3 errors<br />rel.66:&nbsp;&nbsp; 18m<br />rel.72: 1h6m<=
br />rel.73 45m, 3 errors ( CheckSpeciesSetTag:2 and ForeignKeyMethodLinkSp=
eciesSetId:1 - detected unused SpeciesSets that were erroneously transferre=
d over from prev. release)</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Testwebserver"><span>Test web se=
rver</span></h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"185"><span>Ask ensembl-product=
ion to point the test web server to the compara release database</span> <br=
 /> <span>Upon confirmation from the release coordinator ask other members =
of Compara to check their data on:<br />&nbsp;&nbsp;&nbsp; <a href=3D"http:=
//staging.ensembl.org/" class=3D"external-link" rel=3D"nofollow">http://sta=
ging.ensembl.org/</a> <br /> <br /> </span></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-RunANALYZE_TABLEandOPTIMIZETABLE=
"><span>Run ANALYZE_TABLE and OPTIMIZE TABLE</span></h3>
<p>This is required for the CopyDbOverServer script to work properly.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"398"><p><span>&nbsp;</span>Run=
 ANALYZE_TABLE on compara and ancestral databases</p>=20
<div id=3D"expander-1251314215" class=3D"expand-container">=20
<div id=3D"expander-control-1251314215" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1251314215" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>analyze table</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time eval mysqlcheck `db_cmd.pl $COMPARA_REG compara_curr -to_p=
arams` --analyze --verbose
time eval mysqlcheck `db_cmd.pl $COMPARA_REG ancestral_curr --reg_type core=
 -to_params` --analyze --verbose</pre>=20
</div>
</div>=20
<div id=3D"expander-2094321003" class=3D"expand-container">=20
<div id=3D"expander-control-2094321003" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-2094321003" class=3D"expand-content">
<p>rel.56&nbsp;&nbsp;&nbsp; 12min</p>
<p>rel.pre57 30+105min</p>
<p>rel.57&nbsp;&nbsp;&nbsp; 9+4+5min</p>
<p>rel.58&nbsp;&nbsp;&nbsp; 3min</p>
<p>rel.62&nbsp;&nbsp;&nbsp; 6min</p>
<p>rel.63&nbsp;&nbsp;&nbsp; 25m</p>
<p>rel.64&nbsp;&nbsp;&nbsp; 16m</p>
<p>rel.65&nbsp;&nbsp;&nbsp; 21m</p>
<p>rel.66&nbsp;&nbsp;&nbsp;&nbsp; 9m</p>
<p>rel.71&nbsp;&nbsp;&nbsp;&nbsp; 7m</p>
<p>rel.72&nbsp;&nbsp;&nbsp; 10m49.630s</p>
<p>rel.73 6m</p>
<p>rel.75 23+1sec</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"404"><p>Run OPTIMIZE TABLE on =
compara and ancestral databases</p>=20
<div id=3D"expander-98226070" class=3D"expand-container">=20
<div id=3D"expander-control-98226070" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-98226070" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>optimize table</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time eval mysqlcheck `db_cmd.pl $COMPARA_REG compara_curr -to_p=
arams` --optimize --verbose
time eval mysqlcheck `db_cmd.pl $COMPARA_REG ancestral_curr --reg_type core=
 -to_params` --optimize --verbose</pre>=20
</div>
</div>=20
<div id=3D"expander-622077171" class=3D"expand-container">=20
<div id=3D"expander-control-622077171" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-622077171" class=3D"expand-content">
<p>rel.56&nbsp;&nbsp;&nbsp; 2.5 hours</p>
<p>rel.pre57 : took several iterations (not all tables were MyISAM initiall=
y), last one 132min.</p>
<p>rel.57&nbsp;&nbsp;&nbsp; 2+1.6 hours</p>
<p>rel.62&nbsp;&nbsp;&nbsp; 32min</p>
<p>rel.63&nbsp;&nbsp;&nbsp; 61m</p>
<p>rel.64&nbsp;&nbsp;&nbsp; 1.5h</p>
<p>rel.65&nbsp;&nbsp;&nbsp; 3h</p>
<p>rel.66&nbsp;&nbsp;&nbsp; 2h</p>
<p>rel.71&nbsp;&nbsp;&nbsp; 2h</p>
<p>rel.72&nbsp;&nbsp; 104m53.572s</p>
<p>rel.73 4h</p>
<p>rel.75 8.5min + 2sec</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Copydatabasestostagingservers">C=
opy databases to staging servers</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"188"><p><span>Logon to ens-sta=
ging1 and create a file containing the copying options</span></p>=20
<div id=3D"expander-1674035906" class=3D"expand-container">=20
<div id=3D"expander-control-1674035906" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1674035906" class=3D"expand-content">
<p>First, ssh into the DESTINATION machine and switch to the bash shell</p>
<p># NB: ask for the password for mysqlens well in advance - there may be n=
o-one around you at the right moment!</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>ssh</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">ssh mysqlens@ens-staging1
bash</pre>=20
</div>
</div>
<p>Create a file that will contain one line for each database with the sour=
ce/destination parameters, like this:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_options</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cat &lt;&lt;EOF &gt;/tmp/lg4_ensembl_compara_75.copy_options
#from_host      from_port   from_dbname                 to_host         to_=
port     to_dbname
#
compara5        3306        lg4_ensembl_compara_75      ens-staging1     33=
06        ensembl_compara_75
compara5        3306        lg4_ensembl_ancestral_75    ens-staging1     33=
06        ensembl_ancestral_75
EOF</pre>=20
</div>
</div>
<p><span>Set the password into the environment variable</span>:</p>
<p>export ENSADMIN_PSW=3D'...'</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"407"><p>Copy the databases to =
ens-staging1</p>=20
<div id=3D"expander-1688796575" class=3D"expand-container">=20
<div id=3D"expander-control-1688796575" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1688796575" class=3D"expand-content">
<p>You should check whether there is enough space on the disk before starti=
ng the copy.</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>CopyDBoverServer</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time perl ~lg4/work/ensembl/misc-scripts/CopyDBoverServer.pl -p=
ass $ENSADMIN_PSW \
    -noflush /tmp/lg4_ensembl_compara_75.copy_options &gt; /tmp/lg4_ensembl=
_compara_75.copy.err 2&gt;&amp;1</pre>=20
</div>
</div>=20
<div id=3D"expander-501269655" class=3D"expand-container">=20
<div id=3D"expander-control-501269655" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-501269655" class=3D"expand-content">
<p>copying of rel_56 took 2 hours (SUCCESSFUL for both databases - you shou=
ld check the output file)</p>
<p>copying of ensembl_compara_pre57 took 2 hours (SUCCESSFUL)</p>
<p>copying of ensembl_compara_57 took 2 hours (SUCCESSFUL)</p>
<p>copying of ensembl_ancestral_57 took 20 minutes (only SUCCESSFUL after a=
nalyzing/optimizing)</p>
<p>copying of ensembl_compara_58 and ensembl_ancestral_58 together took 1:3=
0h (SUCCESSFUL)</p>
<p>copying of ensembl_compara_62 and ensembl_ancestral_62 took 2h38</p>
<p>copying of ensembl_compara_63 and ensembl_ancestral_63 took 2h</p>
<p>copying of ensembl_compara_64 and ensembl_ancestral_64 took 2h15m</p>
<p>rel.65 2h51m</p>
<p>rel.66 1h12m to copy over ensembl_compara_66</p>
<p>&nbsp;&nbsp; 0h11m to copy over ensembl_ancestral_66</p>
<p>rel.68 90m39.996s</p>
<p>rel.70 ens-staging2 (1h29m4s)</p>
<p>rel.71: 1h39m</p>
<p>rel.72 1h40m50s</p>
<p>rel.73 2h</p>
<p>rel.75: 1h30m (both successful)</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"190"><p><span>Logon to ens-sta=
ging2 and create a file containing the copying options</span></p>=20
<div id=3D"expander-1370278831" class=3D"expand-container">=20
<div id=3D"expander-control-1370278831" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1370278831" class=3D"expand-content">
<p>First, ssh into the DESTINATION machine and switch to the bash shell</p>
<p># NB: ask for the password for mysqlens well in advance - there may be n=
o-one around you at the right moment!</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>ssh</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">ssh mysqlens@ens-staging2
bash</pre>=20
</div>
</div>
<p>Create a file that will contain one line for each database with the sour=
ce/destination parameters, like this:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>copy_options</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cat &lt;&lt;EOF &gt;/tmp/lg4_ensembl_compara_75.copy_options
#from_host      from_port   from_dbname                 to_host         to_=
port     to_dbname
#
compara5        3306        lg4_ensembl_compara_75      ens-staging2     33=
06        ensembl_compara_75
compara5        3306        lg4_ensembl_ancestral_75    ens-staging2     33=
06        ensembl_ancestral_75
EOF</pre>=20
</div>
</div>
<p><span>Set the password into the environment variable</span>:</p>
<p>export ENSADMIN_PSW=3D'...'</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"408"><p>Copy the databases to =
ens-staging2</p>=20
<div id=3D"expander-765967693" class=3D"expand-container">=20
<div id=3D"expander-control-765967693" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-765967693" class=3D"expand-content">
<p>You should check whether there is enough space on the disk before starti=
ng the copy.</p>
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>CopyDBoverServer</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time perl ~lg4/work/ensembl/misc-scripts/CopyDBoverServer.pl -p=
ass $ENSADMIN_PSW \
    -noflush /tmp/lg4_ensembl_compara_75.copy_options &gt; /tmp/lg4_ensembl=
_compara_75.copy.err 2&gt;&amp;1</pre>=20
</div>
</div>=20
<div id=3D"expander-573945872" class=3D"expand-container">=20
<div id=3D"expander-control-573945872" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for times</span>=20
</div>=20
<div id=3D"expander-content-573945872" class=3D"expand-content">
<p>copying of ensembl_compara_58 took 1:15h</p>
<p>copying of ensembl_compara_62 took 1:34h</p>
<p>copying of ensembl_compara_63 took 3:44h</p>
<p>copying of ensembl_compara_64 took 3h51m</p>
<p>rel.65: 3h28m</p>
<p>rel.66: ~2h</p>
<p>rel.68: 104m11.046s</p>
<p>rel.72: 1h40m24s</p>
<p>rel.73: 3.75h (started at the same time as ens-staging1, but start was d=
elayed because of locking)</p>
<p>rel.75: 1h25m (both successful)</p>
</div>=20
</div>=20
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Finalhandoverofdatabases">Final =
handover of databases</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"195"><p>Send an email to ensem=
bl-production to announce the handover the databases</p></li>=20
<li class=3D"checked" data-inline-task-id=3D"196"><p>Update the Declaration=
 of Intentions <a href=3D"http://admin.ensembl.org/index.html" class=3D"ext=
ernal-link" rel=3D"nofollow">http://admin.ensembl.org/index.html</a>to indi=
cate what has been handed over and what didn't make it and has been postpon=
ed</p></li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Updatedocumentationanddiagrams">=
Update documentation and diagrams</h3>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"343"><p><span>Update pipeline =
diagrams</span></p>=20
<div id=3D"expander-125648334" class=3D"expand-container">=20
<div id=3D"expander-control-125648334" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-125648334" class=3D"expand-content">
<p>Update the pipeline diagrams in the docs directory</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>pipeline diagrams</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">export COMPARA_REG=3D&quot;-reg_conf $ENSEMBL_CVS_ROOT_DIR/ense=
mbl-compara/scripts/pipeline/production_reg_conf.pl -reg_type compara -reg_=
alias&quot;
&nbsp;
cd $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/pipelines/diagrams
generate_graph.pl $COMPARA_REG compara_ptrees -output ProteinTrees.png
generate_graph.pl $COMPARA_REG compara_nctrees -output ncRNAtrees.png
generate_graph.pl $COMPARA_REG compara_families -output Families.png
generate_graph.pl -url mysql://ensro@compara3/kb3_pecan_20way_71 -output Me=
rcatorPecan.png
generate_graph.pl -url mysql://ensro@compara4/sf5_epo_35way_68 -output EpoL=
owCoverage.png
generate_graph.pl -url mysql://ensro@compara4/sf5_compara_epo_13way_69 -out=
put Epo.png</pre>=20
</div>
</div>
<p>Commit any changed diagrams to git and push.</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"414"><p><span>Update the schem=
a documentation and diagrams</span></p>=20
<div id=3D"expander-839295390" class=3D"expand-container">=20
<div id=3D"expander-control-839295390" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-839295390" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>generate new schema documentation</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-production/scripts/sql2html.=
pl -i $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/sql/table.sql -o $ENSEMBL_CVS_R=
OOT_DIR/ensembl-compara/docs/schema/compara_schema.html -d Compara -host co=
mpara5 -user ensro -dbname lg4_ensembl_compara_75 -sort_headers 0 -sort_tab=
les 0 -intro $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/intro.html</=
pre>=20
</div>
</div>
<p>Open the output file $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/c=
ompara_schema.html in your browser and check that no example errors are rep=
orted.</p>
<p>If everything looks fine, copy this file to public-plugins and commit&am=
p;push both (the compara one and the webcode one) :</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update schema documentation for web</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cp $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/compara_sc=
hema.html $ENSEMBL_CVS_ROOT_DIR/public-plugins/docs/htdocs/info/docs/api/co=
mpara/</pre>=20
</div>
</div>
<p><span>If necessary, update schema diagrams by loading the </span>$ENSEMB=
L_CVS_ROOT_DIR/ensembl-compara/sql/table.sql schema file into MySQL Workben=
ch, rearrange/colour the nodes and export into PNG.</p>
<p><span>The schema diagrams will have to be copied both to $ENSEMBL_CVS_RO=
OT_DIR/ensembl-compara/docs/schema/diagrams and to public-plugins and commi=
tted&amp;pushed in both repositories:</span></p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>update schema diagrams for web</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">cp -r $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/schema/diagram=
s/*.png $ENSEMBL_CVS_ROOT_DIR/public-plugins/docs/htdocs/info/docs/api/comp=
ara/diagrams/</pre>=20
</div>
</div>
<p><span> <br /> </span></p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"427"><p><span>Update the tutor=
ial documentation</span></p>=20
<div id=3D"expander-521580312" class=3D"expand-container">=20
<div id=3D"expander-control-521580312" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-521580312" class=3D"expand-content">
<p>Update the tutorial documentation compara_tutorial.html in this director=
y:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ENSEMBL_CVS_ROOT_DIR/ensembl-webco=
de/htdocs/info/docs/api/compara/</p>
<p>Be careful that the embedded Perl snippets must use HTML-escaped charact=
ers (e.g. &amp;lt; and &amp;gt;) and be wrapped in a &lt;pre class=3D&quot;=
code sh_perl&quot;&gt;</p>
<p>Open the URL /info/docs/api/compara/compara_tutorial.html from a sandbox=
 / test website and export it as a PDF in</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $ENSEMBL_CVS_ROOT_DIR/ensembl-compa=
ra/docs/ComparaTutorial.pdf</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"285"><p>Update main ensembl sp=
ecies tree if there are any new species</p><p>See&nbsp;$ENSEMBL_CVS_ROOT_DI=
R/ensembl-compara/docs/species_tree/README</p><p>The end result should go h=
ere (check how it should be moved) :&nbsp;<a href=3D"http://www.ensembl.org=
/info/about/species_tree.pdf" class=3D"external-link" rel=3D"nofollow">http=
://www.ensembl.org/info/about/species_tree.pdf</a></p></li>=20
</ul>=20
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"210">Check examples work in ensembl-compara/scri=
pts/examples/<br /> <span style=3D"color: rgb(116,116,116);"> <br /> </span=
></li>=20
<li data-inline-task-id=3D"286"><span>git commit and push any modified file=
s or added tutorial examples</span></li>=20
<li class=3D"checked" data-inline-task-id=3D"426"><span>Update the declared=
 intention with removed / deprecated methods</span><br /><pre>     </pre>=
=20
<div id=3D"expander-1254880509" class=3D"expand-container">=20
<div id=3D"expander-control-1254880509" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click for details</span>=20
</div>=20
<div id=3D"expander-content-1254880509" class=3D"expand-content">
<br />
<p>We need to generate the list of methods exported by the objects / adapto=
rs on the master and release/{$n-1} branches, and compare (diff) them.</p>
<p>&nbsp;</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>Check deprecated / removed methods</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;"># on master/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; *pm | sort &gt; ~/MASTER
# on the previous release/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; *pm | sort &gt; ~/RELEASE75
sdiff -w 200 -bs ~/RELEASE75 ~/MASTER | less

# Let's do the same for the adaptors
# on master/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; DBSQL/*pm | sort &gt; ~/MASTER
# on the previous release/ensembl-compara/modules/Bio/EnsEMBL/Compara/
grep &quot;^sub &quot; DBSQL/*pm | sort &gt; ~/RELEASE75
sdiff -w 200 -bs ~/RELEASE75 ~/MASTER | less

</pre>=20
</div>
</div>
<p>In both cases, make sure the methods are really removed, and not moved t=
o a base / sub class, etc</p>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Datadumps">Data dumps</h3>
<p>These should only be done once ensembl-production has given the go-ahead=
 for this. This is to avoid overloading the databases whilst biomart is bei=
ng run.</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"214"><span>DNA data dumps</spa=
n> <br /> <span>Generally the person who ran the pipeline will also do the =
data dumps. The instructions are in $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/d=
ocs/README.multi_align.dumps</span> <br /> <span>&nbsp;</span></li>=20
<li class=3D"checked" data-inline-task-id=3D"410"><span>Gene tree dumps</sp=
an> <br /> <span> <span>Generally the person who ran the pipeline will also=
 do the data dumps.</span> </span> <br /><p>&nbsp;</p>=20
<div id=3D"expander-1528282008" class=3D"expand-container">=20
<div id=3D"expander-control-1528282008" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1528282008" class=3D"expand-content">
<p>Go to $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/modules/Bio/EnsEMBL/Compara/=
PipeConfig and open the PipeConfig file DumpTrees_conf.pm</p>
<p>Check that you are happy about all parameters. In usual cases, they can =
all be set from the command line and the config file does not need editing.=
</p>
<p>Make sure you have the XML::Writer module in your PERL5LIB (there is a c=
opy in ~mm14/src/perl/orthoxml/)</p>
<p>Run init_pipeline.pl with this file:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>init_pipelline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl Bio::EnsEMBL::Compara::PipeConfig::DumpTrees_c=
onf -rel_coord lg4 -rel_db_host compara5 -pipeline_db -host=3Dcompara1 -mem=
ber_type protein</pre>=20
</div>
</div>=20
<div class=3D"aui-message problem shadowed information-macro">=20
<span class=3D"aui-icon icon-problem">Icon</span>=20
<div class=3D"message-content">=20
<p>rel.64: testing sqlite mode failed: too many occurrences of &quot;databa=
se locked&quot;. We should stick to mysql.</p>=20
</div>=20
</div>=20
<p>Then run both -sync and -loop variations of the beekeeper.pl command sug=
gested by init_pipeline.pl .</p>
<p>This pipeline takes a couple of hours to run and will produce protein_tr=
ee dumps in the directory pointed at by 'target_dir' parameter. ('/lustre/s=
cratch110/ensembl/'.$self-&gt;o('ENV', 'USER').'/'.$self-&gt;o('pipeline_na=
me'))</p>
<p>&nbsp;</p>
<p>Create the ncRNA pipeline from the same config file:</p>
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>init_pipeline</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">init_pipeline.pl Bio::EnsEMBL::Compara::PipeConfig::DumpTrees_c=
onf -rel_coord lg4 -rel_db_host compara5 -pipeline_db -host=3Dcompara1 -mem=
ber_type ncrna</pre>=20
</div>
</div>
<p>&nbsp;&nbsp;&nbsp; Then run both -sync and -loop variations of the beeke=
eper.pl command suggested by init_pipeline.pl .</p>
<p>&nbsp;&nbsp;&nbsp; This pipeline will produce ncrna_tree dumps in the di=
rectory pointed at by 'target_dir' parameter. This is much faster: less tha=
n an hour</p>
<p>Commit the DumpTrees_conf.pm file into git if you'd like to keep the cha=
nges.</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"221"><p>Copy the tree content =
dump for Uniprot</p>=20
<div id=3D"expander-403376771" class=3D"expand-container">=20
<div id=3D"expander-control-403376771" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-403376771" class=3D"expand-content">
<p>The file 'target_dir'/ensembl.GeneTree_content.{release}.txt.gz needs to=
 be copied to the EBI ftp server.<br />You can scp the file to login.ebi.ac=
.<a href=3D"http://uk/nfs/ftp/pub/databases/ensembl/ensembl_compara/" class=
=3D"external-link" rel=3D"nofollow">uk:/nfs/ftp/pub/databases/ensembl/ensem=
bl_compara/</a> and from there, create its MD5 checksum</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"222"><p>Report locations of th=
e dumps to ensembl-production</p>=20
<div id=3D"expander-1229754393" class=3D"expand-container">=20
<div id=3D"expander-control-1229754393" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-1229754393" class=3D"expand-content">
<p>Dna dumps:</p>
<p>Not all the multiple alignments are run for each release. The data dumps=
 for any multiple alignments not run this release should be copied from the=
 previous release. Currently (e72), the full set of mulitple alignments wit=
h the corresponding dump files, are:</p>
<p>6 primates EPO (emf)</p>
<p>13 eutherian mammals EPO (emf)</p>
<p>5 teleost fish EPO (emf)</p>
<p>3 neognath birds EPO (emf)</p>
<p>8 teleost fish EPO_LOW_COVERAGE (emf, bed)</p>
<p>36 eutherian mammals EPO_LOW_COVERAGE (emf, bed)</p>
<p>20 amniota vertebrates Pecan (emf, bed)</p>
<p>Gene tree dumps:</p>
<p>&nbsp;&nbsp;&nbsp; 'target_dir'/emf should go to /emf/ensembl-compara/ho=
mologies/ on the ftp</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; 'target_dir'/xml should go to /xml/ensembl-comp=
ara/homologies/ on the ftp</p>
</div>=20
</div> </li>=20
<li class=3D"checked" data-inline-task-id=3D"431"><p>Ancestral alleles (for=
 the Variation team)</p>=20
<div id=3D"expander-1960721853" class=3D"expand-container">=20
<div id=3D"expander-control-1960721853" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here to expand...</span>=20
</div>=20
<div id=3D"expander-content-1960721853" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: bash; gutter: false" style=3D"font-=
size:12px;">perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/ancestral_se=
quences/get_ancestral_sequence.pl --conf $ENSEMBL_CVS_ROOT_DIR/ensembl-comp=
ara/scripts/pipeline/production_reg_conf.pl --compara_url mysql://ensro@com=
para5/sf5_epo_8primates_77 --species homo_sapiens
dirname=3Dhomo_sapiens*
cd $dirname
perl $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/scripts/ancestral_sequences/get_=
stats.pl &gt; summary.txt
cd ..
tar -jcf ${dirname}.tar.bz2 $dirname
md5sum ${dirname}.tar.bz2 &gt; ${dirname}.tar.bz2.MD5SUM</pre>=20
</div>
</div>
</div>=20
</div> </li>=20
</ul>=20
<h3 id=3D"Releasecoordinationdocumentation-Finalthings">Final things</h3>
<p>&nbsp;</p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li class=3D"checked" data-inline-task-id=3D"419">Dump the master database =
and place the copy in a safe place</li>=20
</ul>=20
<div id=3D"expander-652081075" class=3D"expand-container">=20
<div id=3D"expander-control-652081075" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-652081075" class=3D"expand-content">
<div class=3D"code panel pdl" style=3D"border-width: 1px;">
<div class=3D"codeHeader panelHeader pdl" style=3D"border-bottom-width: 1px=
;">
<b>dump master database</b>
</div>
<div class=3D"codeContent panelContent pdl">=20
<pre class=3D"theme: Confluence; brush: java; gutter: false" style=3D"font-=
size:12px;">time eval mysqldump -t `db_cmd.pl $COMPARA_REG compara_master -=
to_params` | gzip - &gt;/warehouse/ensembl01/compara/master_dumps/ensembl_c=
ompara_master_75.mysql.gz</pre>=20
</div>
</div>
<p>prev (rel65) /warehouse/ensembl01/sf5/Compara_master_dumpps/sf5_ensembl_=
compara_master.sql.04_01_12.gz</p>
<p>rel.65&nbsp; /warehouse/ensembl01/compara/master_dumps/sf5_ensembl_compa=
ra_master.sql.04_01_12.gz</p>
<p>rel.66 /warehouse/ensembl01/compara/master_dumps/sf5_ensembl_compara_mas=
ter.66.gz (3min to dump)</p>
<p>rel.71 /warehouse/ensembl01/compara/master_dumps/sf5_ensembl_compara_mas=
ter.71.gz (3min to dump)</p>
<p>rel.75 /warehouse/ensembl01/compara/master_dumps/ensembl_compara_master_=
75.mysql.gz (46 sec to dump)</p>
<p>rel.76 /warehouse/ensembl01/compara/master_dumps/ensembl_compara_master_=
76.gz</p>
<p>rel.77 /warehouse/ensembl01/compara/master_dumps/ensembl_compara_master_=
77.gz (33 sec to dump)</p>
</div>=20
</div>=20
<p><span> <br /> </span></p>
<ul class=3D"inline-task-list" data-inline-tasks-content-id=3D"21174007">=
=20
<li data-inline-task-id=3D"420"><span>Create a word document and a pdf dump=
 of this document</span></li>=20
</ul>=20
<p><span>&nbsp;</span></p>=20
<div id=3D"expander-2090451853" class=3D"expand-container">=20
<div id=3D"expander-control-2090451853" class=3D"expand-control">=20
<span class=3D"expand-control-icon"><img style=3D"vertical-align:middle;" c=
lass=3D"expand-control-image" src=3D"81c4be8bbc84ad58a16c9a5b9cee7752" widt=
h=3D"16" height=3D"16" /></span>
<span class=3D"expand-control-text">Click here for details</span>=20
</div>=20
<div id=3D"expander-content-2090451853" class=3D"expand-content">
<p>In the top-right menu of this Confluence page, choose &quot;Tools -&gt; =
Export to PDF&quot; and &quot;Tools -&gt; Export to Word&quot;.</p>
<p>Put these files into $ENSEMBL_CVS_ROOT_DIR/ensembl-compara/docs/</p>
<p>git commit and push</p>
</div>=20
</div>=20
<p>&nbsp;</p>
<p>&nbsp;</p>
<pre>./run-configurable-testrunner.sh -h compara5 -d sf5_ensembl_compara_77=
 </pre>
    </div>
</body>
</html>
------=_Part_17309_203323822.1411131409511
Content-Type: image/png
Content-Transfer-Encoding: base64
Content-Location: file:///C:/81c4be8bbc84ad58a16c9a5b9cee7752

iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAA3NCSVQICAjb4U/gAAAAFVBMVEX/
//9wcHBwcHBwcHBwcHBwcHBwcHA3RenHAAAAB3RSTlMAZoiZzN3/SzZomQAAAAlwSFlzAAALEgAA
CxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAAUdEVYdENy
ZWF0aW9uIFRpbWUANi8xLzEzOKlF0AAAACFJREFUCJljYCATsCgwqIAZTMnMyRAhsTABCIMxkVxT
GQCLcwHyUKXpLgAAAABJRU5ErkJggg==
------=_Part_17309_203323822.1411131409511--
