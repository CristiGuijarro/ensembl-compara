
Example for Hs35 against Mm33

1- download the sql data from ucsc

cd /ecs2/work3/abel/blastz/Hs35Mm33/
mkdir ucsc_sql;cd ucsc_sql

wget -t 5 http://hgdownload.cse.ucsc.edu/goldenPath/hg17/database

(replace hg17 with the species abbreviation of interest (check by going to a webpage and typing in the URL -- it should be a valid webpage)

Then you have to know what is the mouse abbreviation used by UCSC, here is mm5


to find out what the abreviation might be 
grep "net" index.html |awk -F "\"" '{print $6}'|grep ^net
and check through the output for an abbreviation that looks relevent.

Then wget the files with:

grep Mm5 index.html |awk -F "\"" '{print $6}'|grep -e net -e chain|while read i;do wget -t 5 http://hgdownload.cse.ucsc.edu/goldenPath/hg17/database/$i;done

again remembering to replace hg17 with the relevent species abbreviation. Note they tend to be in the format of canFam1 or xenTro1 or galGal2 for more recently added species.

You may also download the goldenpath data if you want to map alignments on the *_random genes:

grep random_gold index.html | awk -F "\"" '{print $6}' | while read i; do wget -t 5 \
http://hgdownload.cse.ucsc.edu/goldenPath/hg17/database/$i; done

2- set up a mysql database

mysql -h ecs2 -P3366 -u ensadmin -pensembl -e "create database abel_ucsc_chain_data_Hs35Mm33"

 create the tables

ls *.sql|while read i;do mysql -h ecs2 -P3366 -u ensadmin -pensembl abel_ucsc_chain_data_Hs35Mm33 < $i;done

 load the data

ls *.gz|sed "s/\.gz//"|while read i;do echo "Loading $i...";gunzip $i.gz;mysqlimport -h ecs2 -P3366 -u ensadmin -pensembl abel_ucsc_chain_data_Hs35Mm33 $i;gzip $i;echo $i loaded;done

mysqlimport didn not work on ia64e so use the following instead:

ls *.gz | sed "s/\.txt.gz//" | while read i ; do echo "Loading $i..." ; gunzip $i.txt.gz ; mysql -h ia64e -pensembl -u ensadmin -e "load data local infile '/ecs2/scratch3/cara/UCSC/Mm33Xt1/ucsc_sql/$i.txt' into table $i" cara_ucsc_chain_data_xenTro1mm5 ; gzip $i.txt ; echo $i loaded ; done

Load in compara

cd ..; mkdir load; cd ../load

NB: You need to have an ensembl_compara database with method_links, dnafrags and genome_dbs!!

Run the script first with the --check_length option first to see if the chromosomes lengths match between ensembl and UCSC 
/nfs/acari/abel/src/ensembl_main/ensembl-compara/scripts/blastz/LoadUcscNetData.pl \
 --ucsc_dbname ucscHs35Mm33 --dbname abelcompara26 --tSpecies human --qSpecies Mm5 \
 --reg_conf /nfs/acari/abel/.Registry.conf --check_length

Then load the data: 
mysql -h ecs2 -P3366 -u ensro -N -e "show tables" abel_ucsc_chain_data_Hs35Mm33 |\
 grep -v gold |awk -F "_chain" '/^chr/ {print $1}'| sort -u |\
 while read i; do bsub -o $i.out \
   /nfs/acari/abel/src/ensembl_main/ensembl-compara/scripts/blastz/LoadUcscNetData.pl \
   --ucsc_dbname ucscHs35Mm33 \
   --dbname abelcompara26 \
   --tSpecies human \
   --tName $i \
   --qSpecies Mm5 \
   --method_link_type BLASTZ_NET \
   --reg_conf /nfs/acari/abel/.Registry.conf \
 ;done

Here is another example:
mysql -h ia64f -u ensro -N -e "show tables" jh7_ucsc_chain_net_Hg17RheMac1 | \
  grep -v gold | awk -F "_chain" '/^chr/ {print $1}'| sort -u | \
  while read i; do bsub -o $i.out -J hg17-RheMac1-$i -q basement \
    /nfs/acari/jh7/src/ensembl_main/ensembl-compara/scripts/blastz/LoadUcscNetData.pl \
    --ucsc_dbname ucsc_compara \
    --dbname ensembl_compara \
    --tSpecies hg17 \
    --tName $i \
    --qSpecies RheMac1 \
    --method_link_type BLASTZ_NET \
    --reg_conf /ecs4/work1/jh7/data/BlastZ/Homo_sapiens_NCBI35.vs.Macaca_mulata_Mmul0.1/load/registry.conf \
  ; done

WARNING:

1. The taxon_id is hard coded into the loading script so that it knows which matrix to use. This needs to be added each time a new species is added. 

2. The method_link_species_set_id is automatically set if it does not exist before. You probably want to create one with a specific dbID!

 The only requirement here is that the registry alias name of the --qSpecies (in the example Mm5) has 
to be the same as the name of the netMm5 table in the UCSC database.
For example, if the net table from UCSC is named netGalGal2, one of registry alias name of the corresponding chicken core
database has to be GalGal2.
And obviously you should have aliases set for -tSpecies, whatever you like. You should also have aliases set for the 
ucsc databases e.g. here

new Bio::EnsEMBL::Compara::DBSQL::DBAdaptor(-host => 'ecs2',
                                            -user => 'ensadmin',
                                            -pass => 'ensembl',
                                            -port => 3366,
                                            -disconnect_when_inactive => 1,
                                            -species => 'ucscHs35Mm33',
                                            -dbname => 'abel_ucsc_chain_data_Hs35Mm33');

the only alias is ucscHs35Mm33.
