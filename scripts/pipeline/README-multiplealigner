

1- code API needed and executable
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  bioperl-live (bioperl-1-2-0?)
  ensembl
  ensembl-compara
  ensembl-hive
  ensembl-pipeline
  ensembl-analysis

  executables
  ~~~~~~~~~~~
  blastz
      using /usr/local/ensembl/bin/blastz

1.2 Code checkout

      cvs -d :ext:bio.perl.org:/home/repository/bioperl co -r branch-07 bioperl-live
      cvs -d :ext:cvs.sanger.ac.uk:/nfs/ensembl/cvsroot co ensembl
      cvs -d :ext:cvs.sanger.ac.uk:/nfs/ensembl/cvsroot co  ensembl-pipeline
      cvs -d :ext:cvs.sanger.ac.uk:/nfs/ensembl/cvsroot co  ensembl-hive
      cvs -d :ext:cvs.sanger.ac.uk:/nfs/ensembl/cvsroot co  ensembl-analysis

in tcsh
    setenv BASEDIR   /some/path/to/modules
    setenv PERL5LIB  ${BASEDIR}/ensembl/modules:${BASEDIR}/ensembl-pipeline/modules:${BASEDIR}/bioperl-live:${BASEDIR}/ensembl-compara:${BASEDIR}/ensembl-hive:${BASEDIR}/ensembl-analysis
    setenv PATH $PATH:${BASEDIR}/ensembl-compara/script/pipeline:${BASEDIR}/ensembl-hive/scripts

in bash
    BASEDIR=/some/path/to/modules
    PERL5LIB=${BASEDIR}/ensembl/modules:${BASEDIR}/ensembl-pipeline/modules:${BASEDIR}/bioperl-live:${BASEDIR}/ensembl-compara:${BASEDIR}/ensembl-hive:${BASEDIR}/ensembl-hive
    PATH=$PATH:${BASEDIR}/ensembl-compara/scripts/pipeline:${BASEDIR}/ensembl-hive/scripts


2- Create a hive/compara database
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Pick a mysql instance and create a database

mysql -h ia64g -P3306 -uensadmin -pxxxx -e "create database abel_compara_mlagan"

cd ~/src/ensembl_main/ensembl-hive/sql
mysql -h ia64g -P3306 -uensadmin -pxxxx abel_compara_mlagan < tables.sql

cd ~/src/ensembl_main/ensembl-compara/sql
mysql -h ia64g -P3306 -uensadmin -pxxxx abel_compara_mlagan < table.sql
mysql -h ia64g -P3306 -uensadmin -pxxxx abel_compara_mlagan < pipeline-tables.sql

3- Choose a working directory with some disk space
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The multiple aligner pipeline tries to minize the amount of output data for workers. But if 
debug options is on this can take some space. So be careful.

mkdir -p /acari/work7a/abel/hive/abel_compara_mlagan/workers
mkdir -p /acari/work7a/abel/hive/abel_compara_mlagan/blastDB

This directory needs to be set in 'hive_output_dir' variable in the compara-hive
configuration file. See below. If not set, all STDOUT/STDERR goes to /dev/null. :)
'fasta_dir' and 'tree_file' will need to be updated as well.
An example of a tree file is given hmr.tree.example. It is in Newick/New Hampshire format.
The species names should correspond to the genome_db_id of the species used (and defined in the 
hive configuration file).

4- Copy and modify your compara-hive config file
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

cd /acari/work7a/abel/hive/abel_compara_mlagan

cp ~/src/ensembl_main/ensembl-compara/scripts/pipeline/compara-hive-pairaligner.conf.example hive.conf.pl
<editor> hive.conf.pl

you may need to change the database names, port, dbnames, and the
paths to the 'hive_output_dir' to
/acari/work7a/abel/hive/abel_compara_mlagan/workers

5- Run the configure scripts
   ~~~~~~~~~~~~~~~~~~~~~~~~~
The following scripts are in ensembl-compara/scripts/pipeline (should be in your PATH)
The order of execution is important

comparaLoadGenomes.pl -conf hive.conf.pl
loadMultipleAlignerSystem.pl -conf hive.conf.pl

The comparaLoadGenomes script use the information in the conf file to connect to
the core databases, queries for things like taxon_id, assembly, gene_build, and names
to create entries in the genome_db table.  It also sets the genome_db.locator column to
allow the system to know where the respective core databases are located. This script 
will also 'seed' the pipeline/hive system by creating the first jobs in the analysis_job
table for the analysis 'SubmitGenome'.

The loadMultipleAlingerSystem script creates the analysis entries for the processing
system, and creates both the dataflow rule and the analysis control rules.
It also initializes the analysis_stats row for each analysis.  These row hold
information like batch_size, hive_capacity, and run-time stats that the Hive's
Queen will update.

These scripts may give you warnings if the output directories are not available or if
it's unable to connect to core databases.

At this point the system is ready to run


6- Run the beekeeper
   ~~~~~~~~~~~~~~~~~

Run it on i386 (32-bits) machines (The mercator part works only on these machines).

The following scripts are in ensembl-hive/scripts (should be in your PATH)
beekeeper.pl -lsf_options "-R\"type==LINUX86\"" -url mysql://ensadmin:xxxx@ia64g:3306/abel_compara_mlagan -loop

where xxxx is the password for write access to the database

for more details on controling/monitoring the hive system see 
beekeeper -help



