
For now, the genetree process is an add-on to the homology pipeline.
Please start reading README-homology first.

1- Load the NCBI taxonomy data 
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~
Ideally this should be a job by itself in the pipeline but for now, it's done by hand :)

All instructions to do it are in ensembl-compara/scripts/taxonomy/README-taxonomy

2- Create the other gene tree-related tables in the database
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

mysql -hia64e -uensadmin -pensembl abel_compara_tree_37 < ensembl-compara/sql/protein_tree.sql

This will create 3 tables
protein_tree_node
protein_tree_member
protein_tree_tag

3- Copy and modify the compara-hive config file
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

You may need to change the database names, port, dbnames, and the
paths to the 'hive_output_dir' and 'fasta_dir'. Note that these dirs
must exist.

  $ cd $BASEDIR/ensembl-compara/scripts/pipeline
  $ cp compara-hive-homology.conf.example my_compara.conf
  <editor> my_compara.conf

   { TYPE => GENE_TREE,
     'cluster_params' => '{species_set=>[3,4,5,7,10,11,13,14,15,16,17,18,22,24,25,26,27,28,29,31,32,33,34,35,36], brh=>1, all_best=>0, bsr_threshold=>0.33}',
     'breakcluster_params' => '{species_set=>[3,4,5,7,10,11,13,14,15,16,17,18,22,24,25,26,27,28,29,31,32,33,34,35,36], bsr_threshold_increase=>0.1}',
     'max_gene_count' => 2000,
     'species_tree_file' => "{species_tree_file=>'/ecs2/work2/avilella/hive/avilella_compara_homology_40/compara_encode_species_tree_40_mfurc.nh'}",
     'rap_jar_file' => '/ecs2/work2/avilella/bin/rap.jar'
   },
 
One example of the species_tree_file can be found in ensembl-compara/scripts/pipeline/species_tree_rap.nh

5- Run the configure scripts
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The loadGeneTreeSystem script creates the analysis entries for the
processing system, and creates both the dataflow rule and the analysis
control rules.  It also initializes the analysis_stats row for each
analysis.  These rows hold information like batch_size, hive_capacity,
and run-time stats that the Hive's Queen will update.

These scripts may give you warnings if the output directories are not
available or if it's unable to connect to core databases.

 $ cd $BASEDIR/ensembl-compara/scripts/pipeline
 $ ./loadGeneTreeSystem.pl -conf my_compara.conf

At this point the system is ready to run using the beekeeper.pl script
as explained in the README-homology



